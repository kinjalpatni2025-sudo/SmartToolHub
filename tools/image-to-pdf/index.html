<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Image to PDF Converter - Smarttool Hub</title>
  <meta name="description" content="Convert multiple images to a single PDF in the browser. Preserve quality, compress to JPG, and download." />
  <link rel="icon" href="https://img.icons8.com/fluency/48/toolbox.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <style>
    /* Kept same design language as your uploaded tools */
    :root{
      --bg:#0b1220;--text:#eaf2ff;--card:#182335;--border:#2a3b55;
      --primary:#22d3ee;--muted:#9fb3c8;--radius:12px;
    }
    body.light{
      --bg:#f6f8fb;--text:#0b1220;--card:#ffffff;--border:#e6eefc;
      --primary:#0b74ff;--muted:#556677;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg);color:var(--text);transition:background .25s,color .25s;
      min-height:100vh;display:flex;flex-direction:column;
    }
    .container{max-width:1200px;margin:0 auto;padding:20px;width:100%}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      background:var(--card);border-bottom:1px solid var(--border);padding:14px 20px;
    }
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:46px;height:46px;border-radius:10px}
    .brand .title{font-size:1.25rem;font-weight:700;color:var(--primary);margin:0}
    .brand .tag{font-size:.9rem;color:var(--muted)}
    .header-actions{display:flex;gap:10px;align-items:center}
    .btn-header{
      border:1px solid var(--border);background:transparent;padding:8px 12px;border-radius:8px;
      color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;text-decoration:none;font-weight:600
    }
    .btn-header:hover{border-color:var(--primary);color:var(--primary)}

    .tool-content {
      background:var(--card);border-radius:var(--radius);border:1px solid var(--border);
      padding:25px;margin-top:20px;
    }
    .tool-title { font-size:1.8rem;margin-bottom:5px;color:var(--primary); }
    .tool-description { color:var(--muted);margin-bottom:18px; }

    .upload-area {
      border:2px dashed var(--border);border-radius:var(--radius);padding:30px;
      text-align:center;margin-bottom:20px;transition:all 0.3s;cursor:pointer;
      background:var(--bg);
    }
    .upload-area:hover, .upload-area.dragover { border-color:var(--primary);background:rgba(34,211,238,0.03); }
    .upload-icon { font-size:3rem;color:var(--muted);margin-bottom:12px; }
    .upload-text { color:var(--text);margin-bottom:10px;font-weight:600; }
    .upload-subtext { color:var(--muted);font-size:0.9rem; }
    .file-input { display:none; }

    .selected-list {
      display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-bottom:18px;
    }
    .file-card {
      background:var(--bg);border:1px solid var(--border);padding:12px;border-radius:10px;display:flex;gap:12px;align-items:flex-start;
    }
    .thumb {width:96px;height:72px;border-radius:8px;object-fit:cover;background:#0f1720;border:1px solid var(--border)}
    .file-meta {flex:1}
    .file-meta h5{margin:0 0 6px 0;font-size:0.95rem;color:var(--text)}
    .file-meta p{margin:0;color:var(--muted);font-size:0.88rem}
    .file-actions {display:flex;flex-direction:column;gap:8px}
    .small-btn {padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
    .small-btn.primary {background:var(--primary);color:#00131f}
    .small-btn.secondary {background:var(--card);border:1px solid var(--border);color:var(--text)}

    .options-row { display:flex;gap:12px;align-items:center;margin-bottom:14px;flex-wrap:wrap; }
    .option { background:var(--bg);border:1px solid var(--border);padding:8px 12px;border-radius:8px;color:var(--muted); }
    .quality-slider { display:flex;gap:8px;align-items:center; }

    .action-buttons { display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px;align-items:center; }
    .btn { padding:12px 20px;border-radius:var(--radius);border:none;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px; }
    .btn-primary { background:var(--primary);color:#00131f; }
    .btn-secondary { background:var(--card);color:var(--text);border:1px solid var(--border); }
    .btn:disabled { opacity:0.6;cursor:not-allowed; }

    .status-message {
      margin-top:15px;padding:10px;border-radius:var(--radius);
      background:var(--bg);border:1px solid var(--border);
      color:var(--muted);font-size:0.9rem;display:none;
    }
    .status-success { border-color:#10b981;color:#10b981; }
    .status-error { border-color:#ef4444;color:#ef4444; }

    footer{margin-top:auto;padding:18px 0;background:var(--card);border-top:1px solid var(--border)}
    .footer-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .footer-links{display:flex;gap:14px;flex-wrap:wrap}
    .footer-links a{color:var(--primary);text-decoration:none;font-weight:600}

    @media (max-width:720px){
      header{flex-direction:column;align-items:flex-start;gap:10px}
      .header-actions{align-self:flex-end}
      .options-row{flex-direction:column;align-items:stretch}
      .action-buttons{flex-direction:column}
      .btn{width:100%;justify-content:center}
    }
  </style>
</head>
<body>
<header class="container">
  <div class="brand">
    <a href="index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;">
      <img src="https://img.icons8.com/fluency/48/toolbox.png" alt="Smarttool Hub Logo">
      <div>
        <div class="title">Smarttool Hub</div>
        <div class="tag">Fast • Private • 100% Client-side</div>
      </div>
    </a>
  </div>
  <div class="header-actions">
    <a href="index.html" class="btn-header"><i class="fa-solid fa-house"></i> Home</a>
    <button class="btn-header" id="themeToggle" title="Toggle dark/light mode"><i class="fa-solid fa-moon"></i></button>
  </div>
</header>

<main class="container">
  <div class="tool-content">
    <h1 class="tool-title">Image to PDF Converter</h1>
    <p class="tool-description">Convert multiple images (PNG/JPG) into a single PDF. All processing is done in your browser — no uploads to a server.</p>

    <div class="upload-area" id="uploadArea" title="Click or drop images here (PNG/JPG) to add multiple files">
      <div class="upload-icon"><i class="fas fa-file-image"></i></div>
      <div class="upload-text">Drop images here or click to browse</div>
      <div class="upload-subtext">Supports PNG and JPG — select multiple. Images will be added in selected order.</div>
      <input type="file" id="fileInput" class="file-input" accept=".png,.jpg,.jpeg" multiple>
    </div>

    <div id="selectedList" class="selected-list" aria-live="polite"></div>

    <div class="options-row">
      <div class="option">
        <label style="display:flex;gap:8px;align-items:center;">
          <input type="checkbox" id="convertToJpg" checked /> Convert images to JPG (smaller PDF)
        </label>
      </div>

      <div class="option quality-slider" id="qualityWrap">
        <label style="font-weight:700;color:var(--text);">JPG Quality</label>
        <input type="range" id="qualitySlider" min="40" max="100" value="85" />
        <div id="qualityValue" style="min-width:48px;text-align:center;color:var(--muted)">85%</div>
      </div>

      <div class="option">
        <label style="display:flex;gap:8px;align-items:center;">
          <input type="checkbox" id="oneImagePerPage" checked /> One image per PDF page
        </label>
      </div>

      <div class="option">
        <label style="display:flex;gap:8px;align-items:center;">
          PDF Page Size:
          <select id="pageSizeSelect" style="margin-left:8px;padding:6px;border-radius:6px;background:var(--card);border:1px solid var(--border);color:var(--text)">
            <option value="a4">A4 (210×297 mm)</option>
            <option value="letter">Letter (8.5×11 in)</option>
          </select>
        </label>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn btn-primary" id="generateBtn" disabled><i class="fas fa-file-pdf"></i> Generate PDF</button>
      <button class="btn btn-secondary" id="downloadBtn" disabled><i class="fas fa-download"></i> Download PDF</button>
      <button class="btn btn-secondary" id="resetBtn"><i class="fas fa-redo"></i> Reset</button>
      <div style="margin-left:auto;color:var(--muted);font-weight:600" id="summaryText">No files selected</div>
    </div>

    <div id="statusMessage" class="status-message"></div>
  </div>
</main>

<footer class="container">
  <div class="footer-inner">
    <div>© <span id="year"></span> Smarttool Hub</div>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="contact.html">Contact</a>
    </div>
  </div>
</footer>

<!-- jsPDF (UMD) -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
  // Basic initialization & theme
  document.getElementById('year').textContent = new Date().getFullYear();
  const themeToggle = document.getElementById('themeToggle');
  if (localStorage.getItem('sth_theme') === 'light') {
    document.body.classList.add('light');
    themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
  }
  themeToggle.onclick = () => {
    document.body.classList.toggle('light');
    if (document.body.classList.contains('light')) { themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>'; localStorage.setItem('sth_theme','light'); }
    else { themeToggle.innerHTML = '<i class="fa-solid fa-moon"></i>'; localStorage.removeItem('sth_theme'); }
  };

  // Elements
  const uploadArea = document.getElementById('uploadArea');
  const fileInput = document.getElementById('fileInput');
  const selectedList = document.getElementById('selectedList');
  const generateBtn = document.getElementById('generateBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const resetBtn = document.getElementById('resetBtn');
  const summaryText = document.getElementById('summaryText');
  const statusMessage = document.getElementById('statusMessage');

  const convertToJpg = document.getElementById('convertToJpg');
  const qualitySlider = document.getElementById('qualitySlider');
  const qualityValue = document.getElementById('qualityValue');
  const oneImagePerPage = document.getElementById('oneImagePerPage');
  const pageSizeSelect = document.getElementById('pageSizeSelect');

  // State
  let filesState = []; // {id, file, dataUrl, width, height}
  let generatedPdfBlob = null;

  // Helpers
  function uid(){ return 'f_'+Math.random().toString(36).slice(2,9); }
  function isImage(f){ return f && (f.type === 'image/png' || f.type === 'image/jpeg'); }
  function showStatus(msg, type='success', autoHide=true){
    statusMessage.textContent = msg;
    statusMessage.classList.remove('status-success','status-error');
    statusMessage.style.display = 'block';
    if (type === 'success') statusMessage.classList.add('status-success');
    if (type === 'error') statusMessage.classList.add('status-error');
    if (autoHide) setTimeout(()=> statusMessage.style.display='none', 4500);
  }
  function formatFileSize(bytes){
    if (!bytes) return '0 KB';
    return (bytes/1024).toFixed(1) + ' KB';
  }

  // Drag & drop
  uploadArea.addEventListener('click', ()=> fileInput.click());
  uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
  uploadArea.addEventListener('dragleave', e => { e.preventDefault(); uploadArea.classList.remove('dragover'); });
  uploadArea.addEventListener('drop', e => {
    e.preventDefault(); uploadArea.classList.remove('dragover');
    const f = Array.from(e.dataTransfer.files || []);
    handleFilesAdded(f);
  });
  fileInput.addEventListener('change', e => {
    handleFilesAdded(Array.from(e.target.files || []));
    fileInput.value = '';
  });

  function handleFilesAdded(list) {
    const incoming = list.filter(isImage);
    const rejected = list.filter(f => !isImage(f));
    if (rejected.length) showStatus(`${rejected.length} non-image file(s) ignored`, 'error');
    if (!incoming.length) return;
    incoming.forEach(file => {
      const id = uid();
      const entry = { id, file, dataUrl: null, width: 0, height: 0 };
      filesState.push(entry);
      const reader = new FileReader();
      reader.onload = ev => {
        entry.dataUrl = ev.target.result;
        // create Image to read natural width/height
        const img = new Image();
        img.onload = () => { entry.width = img.naturalWidth; entry.height = img.naturalHeight; renderFileCards(); };
        img.onerror = ()=> { entry.width = 0; entry.height = 0; renderFileCards(); };
        img.src = entry.dataUrl;
      };
      reader.readAsDataURL(file);
    });
    renderFileCards();
    updateControls();
    showStatus(`${incoming.length} file(s) added`, 'success');
  }

  // Render cards
  function renderFileCards(){
    selectedList.innerHTML = '';
    filesState.forEach((entry, idx) => {
      const file = entry.file;
      const card = document.createElement('div'); card.className = 'file-card'; card.id = 'card-'+entry.id;
      const img = document.createElement('img'); img.className = 'thumb'; img.src = entry.dataUrl || '';
      img.alt = file.name;
      card.appendChild(img);

      const meta = document.createElement('div'); meta.className='file-meta';
      const h5 = document.createElement('h5'); h5.textContent = file.name; meta.appendChild(h5);
      const p1 = document.createElement('p'); p1.textContent = `${file.type.split('/')[1].toUpperCase()} • ${formatFileSize(file.size)}`; meta.appendChild(p1);
      const p2 = document.createElement('p'); p2.style.marginTop = '6px'; p2.textContent = `Res: ${entry.width || '-'} × ${entry.height || '-'}`; meta.appendChild(p2);
      card.appendChild(meta);

      const actions = document.createElement('div'); actions.className='file-actions';
      // Move up
      const upBtn = document.createElement('button'); upBtn.className='small-btn secondary'; upBtn.innerHTML = '<i class="fa-solid fa-arrow-up"></i>';
      upBtn.title = 'Move up'; upBtn.disabled = idx === 0;
      upBtn.onclick = () => { moveEntry(idx, idx-1); };
      // Move down
      const downBtn = document.createElement('button'); downBtn.className='small-btn secondary'; downBtn.innerHTML = '<i class="fa-solid fa-arrow-down"></i>';
      downBtn.title = 'Move down'; downBtn.disabled = idx === filesState.length - 1;
      downBtn.onclick = () => { moveEntry(idx, idx+1); };
      // Remove
      const removeBtn = document.createElement('button'); removeBtn.className='small-btn secondary'; removeBtn.innerHTML = '<i class="fa-solid fa-trash"></i>';
      removeBtn.title = 'Remove'; removeBtn.onclick = () => { filesState = filesState.filter(f => f.id !== entry.id); renderFileCards(); updateControls(); showStatus('File removed', 'success'); };

      actions.appendChild(upBtn); actions.appendChild(downBtn); actions.appendChild(removeBtn);
      card.appendChild(actions);
      selectedList.appendChild(card);
    });
    summaryText.textContent = filesState.length ? `${filesState.length} file(s) selected` : 'No files selected';
  }

  function moveEntry(from, to) {
    if (to < 0 || to >= filesState.length) return;
    const item = filesState.splice(from,1)[0];
    filesState.splice(to,0,item);
    renderFileCards();
  }

  function updateControls() {
    generateBtn.disabled = filesState.length === 0;
    downloadBtn.disabled = !generatedPdfBlob;
  }

  // Quality slider display
  qualityValue.textContent = `${qualitySlider.value}%`;
  qualitySlider.addEventListener('input', () => { qualityValue.textContent = `${qualitySlider.value}%`; });

  // PDF generation logic
  async function generatePdf() {
    if (filesState.length === 0) { showStatus('No images to convert', 'error'); return; }
    showStatus('Preparing PDF — please wait...', 'success', false);
    generatedPdfBlob = null;
    downloadBtn.disabled = true;

    // jsPDF available as window.jspdf.jsPDF
    const { jsPDF } = window.jspdf;
    if (!jsPDF) {
      showStatus('jsPDF library not available', 'error');
      return;
    }

    // Page sizes in mm
    let pageSize = pageSizeSelect.value || 'a4';
    let pageWidthMM = 210, pageHeightMM = 297; // default A4 portrait
    if (pageSize === 'letter') { pageWidthMM = 216; pageHeightMM = 279; } // 8.5x11 in -> mm

    // Margins
    const marginMM = 10;
    const maxWMM = pageWidthMM - marginMM * 2;
    const maxHMM = pageHeightMM - marginMM * 2;

    // px -> mm conversion (assume 96 DPI)
    const pxToMm = px => px * 25.4 / 96;

    // Create doc (portrait). We'll keep portrait and fit images inside. Using portrait for all pages simplifies output.
    const doc = new jsPDF({ unit: 'mm', format: pageSize, orientation: 'portrait' });

    // Process images sequentially
    for (let i = 0; i < filesState.length; i++) {
      const entry = filesState[i];
      try {
        // Convert image to desired format & quality using canvas (ensures consistent result)
        const imgDataUrl = await imageToDataUrl(entry.dataUrl, convertToJpg.checked, Number(qualitySlider.value) / 100);

        // Create an image object to read its natural size
        const img = await loadImage(imgDataUrl);

        const imgWmm = pxToMm(img.naturalWidth);
        const imgHmm = pxToMm(img.naturalHeight);

        // compute scale to fit within maxWMM x maxHMM
        const scale = Math.min(maxWMM / imgWmm, maxHMM / imgHmm, 1);
        const drawW = imgWmm * scale;
        const drawH = imgHmm * scale;

        // center
        const x = (pageWidthMM - drawW) / 2;
        const y = (pageHeightMM - drawH) / 2;

        // choose format for addImage. Use JPEG for compressed images, else PNG.
        const imgFormat = imgDataUrl.startsWith('data:image/png') ? 'PNG' : 'JPEG';

        // On first iteration, we already have a first page; otherwise add new page
        if (i === 0) {
          // place on first page
        } else {
          doc.addPage(pageSize, 'portrait');
        }

        // add image
        // jsPDF's addImage expects Data URL or binary; pass data URL
        doc.addImage(imgDataUrl, imgFormat, x, y, drawW, drawH);
      } catch (err) {
        console.warn('Failed to process image', entry.file.name, err);
        showStatus(`Failed to process ${entry.file.name}`, 'error');
      }
    }

    // Generate blob
    try {
      const arrayBuf = doc.output('arraybuffer');
      generatedPdfBlob = new Blob([arrayBuf], { type: 'application/pdf' });
      downloadBtn.disabled = false;
      showStatus('PDF generated — ready to download', 'success');
      updateControls();
    } catch (err) {
      console.error('PDF generation failed', err);
      showStatus('Failed to generate PDF', 'error');
    }
  }

  // Converts an image data URL to desired type (JPEG/PNG) and quality by drawing to canvas.
  // Returns a dataURL.
  function imageToDataUrl(srcDataUrl, convertToJpeg = true, quality = 0.85) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = () => {
        // draw at natural size
        const canvas = document.createElement('canvas');
        canvas.width = img.naturalWidth;
        canvas.height = img.naturalHeight;
        const ctx = canvas.getContext('2d');
        // Fill white background if converting PNG with transparency -> JPEG would otherwise have black bg
        if (convertToJpeg) {
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        ctx.drawImage(img, 0, 0);
        try {
          if (convertToJpeg) {
            const dataUrl = canvas.toDataURL('image/jpeg', Math.max(0.4, Math.min(1, quality)));
            resolve(dataUrl);
          } else {
            // keep original as PNG/JPEG; produce PNG to preserve transparency if original was PNG
            // If original was JPEG, using PNG will increase size; so detect original type:
            if (srcDataUrl.startsWith('data:image/jpeg')) {
              // keep jpeg
              resolve(srcDataUrl);
            } else {
              // produce PNG
              const dataUrl = canvas.toDataURL('image/png');
              resolve(dataUrl);
            }
          }
        } catch (err) {
          reject(err);
        }
      };
      img.onerror = (e) => reject(e);
      img.src = srcDataUrl;
    });
  }

  function loadImage(dataUrl) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = () => resolve(img);
      img.onerror = (e) => reject(e);
      img.src = dataUrl;
    });
  }

  // Download PDF
  function downloadPdf() {
    if (!generatedPdfBlob) { showStatus('No PDF to download', 'error'); return; }
    const url = URL.createObjectURL(generatedPdfBlob);
    const a = document.createElement('a');
    const ts = new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
    a.href = url;
    a.download = `images_${ts}.pdf`;
    document.body.appendChild(a);
    a.click();
    setTimeout(()=> {
      URL.revokeObjectURL(url);
      try { document.body.removeChild(a); } catch(e){}
    }, 500);
  }

  // Reset tool
  resetBtn.addEventListener('click', () => {
    filesState = [];
    generatedPdfBlob = null;
    selectedList.innerHTML = '';
    updateControls();
    qualitySlider.value = 85;
    qualityValue.textContent = '85%';
    convertToJpg.checked = true;
    oneImagePerPage.checked = true;
    pageSizeSelect.value = 'a4';
    showStatus('Reset complete', 'success');
  });

  // Wire buttons
  generateBtn.addEventListener('click', async () => {
    generateBtn.disabled = true;
    await generatePdf();
    generateBtn.disabled = false;
  });
  downloadBtn.addEventListener('click', downloadPdf);

  // File card helpers are already wired via renderFileCards (move/remove)
  // Enable/disable controls
  function updateControls() {
    generateBtn.disabled = filesState.length === 0;
    downloadBtn.disabled = !generatedPdfBlob;
    summaryText.textContent = filesState.length ? `${filesState.length} file(s) selected` : 'No files selected';
  }

  // initial state
  updateControls();

  // Utility: remove when page unloads
  window.addEventListener('beforeunload', () => { /* nothing to cleanup client-side */ });

  // Handle drag/drop keyboard accessibility
  uploadArea.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); } });

  // Move/Remove actions, already defined above
  // Expose helper for console debugging if needed
  window._imageToPdf_state = () => ({ filesCount: filesState.length, generated: !!generatedPdfBlob });

</script>
</body>
</html>
