<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Image → PDF (Unlimited) — Smarttool Hub</title>
  <meta name="description" content="Convert unlimited JPG/PNG images to PDF client-side. Large-batch friendly: previews limited for performance, but all images included in PDF."/>
  <link rel="icon" href="https://img.icons8.com/fluency/48/toolbox.png"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <style>
    :root{--bg:#0b1220;--text:#eaf2ff;--card:#182335;--border:#2a3b55;--primary:#22d3ee;--muted:#9fb3c8}
    body.light{--bg:#f6f8fb;--text:#0b1220;--card:#fff;--border:#e6eefc;--primary:#0b74ff;--muted:#556677}
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text);transition:.22s}
    .container{max-width:1100px;margin:0 auto;padding:18px}
    header{display:flex;justify-content:space-between;align-items:center;background:var(--card);padding:10px 18px;border-bottom:1px solid var(--border)}
    .brand a{display:flex;gap:12px;align-items:center;text-decoration:none;color:inherit}
    .brand img{width:46px;height:46px;border-radius:8px}
    .title{font-weight:700;color:var(--primary)} .tag{font-size:.85rem;color:var(--muted)}
    .header-actions{display:flex;gap:8px;align-items:center}
    .btn-header{border:1px solid var(--border);background:transparent;padding:8px 12px;border-radius:8px;color:var(--text);cursor:pointer;display:flex;gap:8px;align-items:center;text-decoration:none;font-weight:600}
    main{padding:18px 0} h1{margin:6px 0 8px;color:var(--primary)}
    .meta{color:var(--muted);margin-bottom:12px}
    .top{display:flex;gap:14px;flex-wrap:wrap}
    .uploader{flex:1;min-height:120px;border-radius:12px;border:2px dashed var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px;background:var(--card);cursor:pointer}
    .uploader:hover{border-color:var(--primary)} input[type=file]{display:none}
    .controls{min-width:240px;display:flex;flex-direction:column;gap:10px}
    select,input[type=number]{padding:8px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text)}
    .preview{margin-top:18px;display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px}
    .thumb{background:var(--card);padding:8px;border-radius:10px;border:1px solid var(--border);position:relative;display:flex;flex-direction:column;align-items:center;gap:8px}
    .thumb img{max-width:100%;max-height:110px;border-radius:6px}
    .remove-btn{position:absolute;top:8px;right:8px;background:rgba(255,0,0,.75);color:#fff;border:none;border-radius:50%;width:26px;height:26px;cursor:pointer}
    .drag-handle{cursor:grab;color:var(--muted);font-size:14px}
    .progress{height:10px;background:var(--border);border-radius:999px;overflow:hidden;margin-top:12px}
    .progress-bar{height:100%;width:0;background:var(--primary);transition:width .22s}
    .actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
    .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--primary);color:#00131f} .btn-ghost{background:transparent;border:1px solid var(--border);color:var(--text)}
    .status{color:var(--muted);display:flex;align-items:center;gap:8px}
    .spinner{width:18px;height:18px;border-radius:50%;border:3px solid rgba(255,255,255,0.08);border-top-color:var(--primary);animation:spin .9s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}} footer{margin-top:24px;padding:12px 0;background:var(--card);border-top:1px solid var(--border)}
    @media(max-width:820px){.top{flex-direction:column}.controls{width:100%}}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="container">
    <div class="brand">
      <a href="../../index.html" title="Back to Smarttool Hub">
        <img src="https://img.icons8.com/fluency/48/toolbox.png" alt="Smarttool Hub logo">
        <div>
          <div class="title">Smarttool Hub</div>
          <div class="tag">Fast • Private • Client-side</div>
        </div>
      </a>
    </div>
    <div class="header-actions">
      <a href="../../index.html" class="btn-header"><i class="fa-solid fa-house"></i> Home</a>
      <button id="themeToggle" class="btn-header" title="Toggle theme"><i class="fa-solid fa-moon"></i></button>
    </div>
  </header>

  <main class="container">
    <h1>Image → PDF Converter (Large-batch / Unlimited)</h1>
    <div class="meta">Upload many images (practically unlimited). Previews are limited for performance; all uploaded images are included when creating the PDF. Browser memory still applies — for huge batches, use a modern desktop browser.</div>

    <div class="top">
      <label class="uploader" id="uploader" title="Click or drop images">
        <div style="font-size:28px;color:var(--primary)"><i class="fa-solid fa-images"></i></div>
        <div style="margin-top:8px;font-weight:700">Click or drag & drop images</div>
        <div style="margin-top:6px;color:var(--muted)">Supported: JPG, PNG, JPEG — multiple allowed</div>
        <input type="file" id="fileInput" accept="image/*" multiple/>
      </label>

      <div class="controls">
        <div>
          <label for="pageSize" style="color:var(--muted);font-weight:700">Page size</label>
          <select id="pageSize"><option value="auto">Auto (image size)</option><option value="a4">A4</option><option value="letter">Letter</option></select>
        </div>
        <div>
          <label for="orientation" style="color:var(--muted);font-weight:700">Orientation</label>
          <select id="orientation"><option value="auto">Auto</option><option value="portrait">Portrait</option><option value="landscape">Landscape</option></select>
        </div>
        <div>
          <label for="margin" style="color:var(--muted);font-weight:700">Margin (px)</label>
          <input id="margin" type="number" min="0" max="200" value="10"/>
        </div>
        <div style="font-size:.9rem;color:var(--muted)">Preview limit: <strong id="previewLimitLabel"></strong>. You can increase it in code (PREVIEW_LIMIT).</div>
      </div>
    </div>

    <div class="progress" aria-hidden="true"><div class="progress-bar" id="progressBar"></div></div>

    <div class="preview" id="preview" aria-live="polite"></div>

    <div class="actions">
      <button id="combineBtn" class="btn btn-primary" disabled><i class="fa-solid fa-file-arrow-down"></i> Combine into single PDF</button>
      <button id="separateZipBtn" class="btn btn-ghost" disabled><i class="fa-solid fa-file-zipper"></i> Download separate PDFs (ZIP)</button>
      <button id="clearBtn" class="btn btn-ghost" disabled><i class="fa-solid fa-trash-can"></i> Clear</button>
      <div class="status" id="status" aria-live="polite"></div>
    </div>
  </main>

  <footer class="container">
    <div>© <span id="year"></span> Smarttool Hub</div>
    <div style="color:var(--muted)">Privacy • Terms • Contact</div>
  </footer>

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"Can I upload unlimited images?","acceptedAnswer":{"@type":"Answer","text":"You can upload many images; practical limits depend on your browser and device memory. This tool supports large batches and disables previews beyond a limit for performance."}}]}
  </script>

  <!-- libs -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <script>
  (function(){
    // ========== CONFIG ==========
    // preview limit controls how many image previews are created in DOM.
    // Set large number for more previews, but be mindful of memory.
    const PREVIEW_LIMIT = 200; // you can increase in code if you want
    document.getElementById('previewLimitLabel').textContent = PREVIEW_LIMIT;

    // ========== DOM refs ==========
    const fileInput = document.getElementById('fileInput');
    const uploader = document.getElementById('uploader');
    const preview = document.getElementById('preview');
    const combineBtn = document.getElementById('combineBtn');
    const separateZipBtn = document.getElementById('separateZipBtn');
    const clearBtn = document.getElementById('clearBtn');
    const progressBar = document.getElementById('progressBar');
    const statusEl = document.getElementById('status');
    const pageSizeEl = document.getElementById('pageSize');
    const orientationEl = document.getElementById('orientation');
    const marginEl = document.getElementById('margin');

    // ========== State ==========
    // items: array of { id, file, urlOrNull, name }
    // urlOrNull is objectURL for preview if created (only for first PREVIEW_LIMIT items)
    let items = [];

    // ========== Helpers ==========
    function uuid(){ return Math.random().toString(36).slice(2,10); }
    function showStatus(txt, busy=false, hideMs=0){
      statusEl.innerHTML = '';
      if(busy) statusEl.insertAdjacentHTML('afterbegin','<span class="spinner" aria-hidden="true"></span>');
      statusEl.insertAdjacentText('beforeend', ' ' + (txt || ''));
      if(hideMs>0) setTimeout(()=> statusEl.textContent='', hideMs);
    }
    function setProgress(p){ progressBar.style.width = Math.min(100, Math.max(0, Math.round(p))) + '%'; }
    function resetProgress(){ progressBar.style.width = '0%'; }
    function sanitize(n){ return n.replace(/[^a-z0-9_\-\.]/gi, '_'); }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    // convert dataURL not used here; we will use file.arrayBuffer() for pdf-lib
    // ========== File handling ==========
    uploader.addEventListener('click', ()=> fileInput.click());
    uploader.addEventListener('dragover', e => { e.preventDefault(); uploader.style.borderColor = 'var(--primary)'; });
    uploader.addEventListener('dragleave', e => { uploader.style.borderColor = ''; });
    uploader.addEventListener('drop', e => { e.preventDefault(); uploader.style.borderColor = ''; handleFiles(e.dataTransfer.files); });
    fileInput.addEventListener('change', e => handleFiles(e.target.files));

    async function handleFiles(fileList){
      const list = Array.from(fileList).filter(f => f.type && f.type.startsWith('image/'));
      if(list.length === 0) return;
      // warn if very large
      if(list.length > 1000) {
        // not blocking, just warning
        showStatus('Large batch detected — processing may take long. Continue...', false, 4000);
      } else {
        showStatus('Adding images...', true, 900);
      }

      // Add sequentially to keep UI responsive
      for(const f of list){
        const id = uuid();
        // create preview URL only if below limit
        let url = null;
        if(items.length < PREVIEW_LIMIT){
          try{ url = URL.createObjectURL(f); } catch(e) { url = null; }
        }
        items.push({ id, file: f, urlOrNull: url, name: f.name });
        // slight pause per file to allow UI to update for very large batches
        await new Promise(r => setTimeout(r, 8));
      }
      render();
      updateButtons();
      // clear input so same files can be selected again if needed
      fileInput.value = '';
      showStatus('', false);
    }

    // ========== Render thumbnails with stable ids ==========
    function render(){
      preview.innerHTML = '';
      if(items.length === 0){
        preview.innerHTML = '<div style="color:var(--muted)">No images uploaded yet.</div>';
        return;
      }
      items.forEach((it, idx) => {
        const box = document.createElement('div');
        box.className = 'thumb';
        box.draggable = true;
        box.dataset.id = it.id;

        // preview image or placeholder
        const imgHtml = it.urlOrNull ? `<img src="${it.urlOrNull}" alt="${escapeHtml(it.name)}">` : `<div style="padding:18px;color:var(--muted);text-align:center">Preview disabled for this item (to save memory)</div>`;

        box.innerHTML = `
          <button class="remove-btn" title="Remove">&times;</button>
          <div class="drag-handle" title="Drag to reorder"><i class="fa-solid fa-grip-lines"></i></div>
          ${imgHtml}
          <div style="font-size:.9rem;color:var(--muted);text-align:center">${escapeHtml(it.name)}</div>
          <button class="btn btn-primary small" style="margin-top:6px">Download PDF</button>
        `;

        // events
        box.querySelector('.remove-btn').addEventListener('click', () => {
          // revoke objectURL if existed
          if(it.urlOrNull) try{ URL.revokeObjectURL(it.urlOrNull); }catch(e){}
          items = items.filter(x => x.id !== it.id);
          render(); updateButtons();
        });
        box.querySelector('.btn-primary').addEventListener('click', () => downloadSinglePDF(it));
        // drag reorder
        box.addEventListener('dragstart', e => { e.dataTransfer.setData('text/plain', it.id); box.style.opacity = '.5'; });
        box.addEventListener('dragend', () => { box.style.opacity = ''; });
        box.addEventListener('dragover', e => { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; });
        box.addEventListener('drop', e => {
          e.preventDefault();
          const fromId = e.dataTransfer.getData('text/plain');
          const toId = it.id;
          if(!fromId || fromId === toId) return;
          const fromIdx = items.findIndex(x => x.id === fromId);
          const toIdx = items.findIndex(x => x.id === toId);
          if(fromIdx < 0 || toIdx < 0) return;
          const [moved] = items.splice(fromIdx, 1);
          items.splice(toIdx, 0, moved);
          render();
        });

        preview.appendChild(box);
      });
    }

    function updateButtons(){
      const has = items.length > 0;
      combineBtn.disabled = !has;
      separateZipBtn.disabled = !has;
      clearBtn.disabled = !has;
      // show a simple count status
      if(has) showStatus(items.length + ' images ready', false);
      else showStatus('', false);
    }

    // ========== PDF logic (use file.arrayBuffer for embed) ==========
    function getPageSpec(imgW, imgH, pageSize, orientation, margin){
      const sizes = { a4:{w:595,h:842}, letter:{w:612,h:792} };
      if(pageSize === 'a4' || pageSize === 'letter'){
        let w = sizes[pageSize].w, h = sizes[pageSize].h;
        if(orientation==='portrait' && w>h) [w,h]=[h,w];
        if(orientation==='landscape' && h>w) [w,h]=[h,w];
        return {pageW:w, pageH:h, maxW:w - margin*2, maxH:h - margin*2};
      } else {
        let pageW = imgW + margin*2, pageH = imgH + margin*2;
        if(orientation==='portrait' && pageW>pageH) [pageW,pageH]=[pageH,pageW];
        if(orientation==='landscape' && pageH>pageW) [pageW,pageH]=[pageH,pageW];
        return {pageW, pageH, maxW: pageW - margin*2, maxH: pageH - margin*2};
      }
    }

    async function combineToSinglePDF(){
      if(items.length === 0) return;
      showStatus('Creating PDF...', true);
      setProgress(0);
      try{
        const pdfDoc = await PDFLib.PDFDocument.create();
        const pageSize = pageSizeEl.value;
        const orientation = orientationEl.value;
        const margin = Number(marginEl.value) || 0;

        // process sequentially to avoid memory spikes
        for(let i=0;i<items.length;i++){
          const it = items[i];
          // read raw bytes
          const arrayBuffer = await it.file.arrayBuffer();
          let embedded;
          const t = (it.file.type || '').toLowerCase();
          if(t.includes('jpeg') || t.includes('jpg')) embedded = await pdfDoc.embedJpg(arrayBuffer);
          else embedded = await pdfDoc.embedPng(arrayBuffer);
          const dims = embedded.scale(1);
          const spec = getPageSpec(dims.width, dims.height, pageSize, orientation, margin);
          const page = pdfDoc.addPage([spec.pageW, spec.pageH]);
          const scale = Math.min(spec.maxW / dims.width, spec.maxH / dims.height, 1);
          const drawW = dims.width * scale, drawH = dims.height * scale;
          const x = (spec.pageW - drawW) / 2, y = (spec.pageH - drawH) / 2;
          page.drawImage(embedded, { x, y, width: drawW, height: drawH });

          // update progress
          setProgress(((i+1)/items.length)*100);
          // small pause for UI responsiveness:
          await new Promise(r => setTimeout(r, 20));

          // free some memory hints: optionally null out file reference (keep name and url)
          // we keep it so user can still remove later; comment next line to keep file refs
          // items[i].file = null; // uncomment if you want to release file references after embed
        }

        const pdfBytes = await pdfDoc.save();
        triggerDownload(new Blob([pdfBytes], {type:'application/pdf'}), 'images_to_pdf.pdf');
        showStatus('Done ✓', false, 2000);
      } catch(err){
        console.error(err);
        showStatus('Conversion failed — check console', false);
      } finally { setTimeout(()=> resetProgress(), 900); }
    }

    async function createSeparateZip(){
      if(items.length === 0) return;
      showStatus('Creating PDFs & ZIP...', true);
      setProgress(0);
      try{
        const zip = new JSZip();
        for(let i=0;i<items.length;i++){
          const it = items[i];
          const pdfDoc = await PDFLib.PDFDocument.create();
          const arrayBuffer = await it.file.arrayBuffer();
          let embedded;
          const t = (it.file.type || '').toLowerCase();
          if(t.includes('jpeg') || t.includes('jpg')) embedded = await pdfDoc.embedJpg(arrayBuffer);
          else embedded = await pdfDoc.embedPng(arrayBuffer);
          const dims = embedded.scale(1);
          const margin = Number(marginEl.value) || 0;
          const spec = getPageSpec(dims.width, dims.height, pageSizeEl.value, orientationEl.value, margin);
          const page = pdfDoc.addPage([spec.pageW, spec.pageH]);
          const scale = Math.min(spec.maxW / dims.width, spec.maxH / dims.height, 1);
          const drawW = dims.width * scale, drawH = dims.height * scale;
          const x = (spec.pageW - drawW) / 2, y = (spec.pageH - drawH) / 2;
          page.drawImage(embedded, { x, y, width: drawW, height: drawH });
          const pdfBytes = await pdfDoc.save();
          zip.file(sanitize(it.name).replace(/\.[^/.]+$/, '') + '.pdf', pdfBytes);
          setProgress(((i+1)/items.length)*100);
          await new Promise(r=>setTimeout(r,20));
        }
        const blob = await zip.generateAsync({type:'blob'});
        triggerDownload(blob, 'images_as_pdfs.zip');
        showStatus('ZIP ready ✓', false, 1800);
      } catch(err){
        console.error(err);
        showStatus('ZIP creation failed', false);
      } finally { setTimeout(()=> resetProgress(), 900); }
    }

    // single item PDF download
    async function downloadSinglePDF(it){
      showStatus('Preparing PDF...', true);
      try{
        const pdfDoc = await PDFLib.PDFDocument.create();
        const arrayBuffer = await it.file.arrayBuffer();
        let embedded;
        const t = (it.file.type || '').toLowerCase();
        if(t.includes('jpeg') || t.includes('jpg')) embedded = await pdfDoc.embedJpg(arrayBuffer);
        else embedded = await pdfDoc.embedPng(arrayBuffer);
        const dims = embedded.scale(1);
        const margin = Number(marginEl.value) || 0;
        const spec = getPageSpec(dims.width, dims.height, pageSizeEl.value, orientationEl.value, margin);
        const page = pdfDoc.addPage([spec.pageW, spec.pageH]);
        const scale = Math.min(spec.maxW / dims.width, spec.maxH / dims.height, 1);
        const drawW = dims.width * scale, drawH = dims.height * scale;
        const x = (spec.pageW - drawW) / 2, y = (spec.pageH - drawH) / 2;
        page.drawImage(embedded, { x, y, width: drawW, height: drawH });
        const pdfBytes = await pdfDoc.save();
        triggerDownload(new Blob([pdfBytes], {type:'application/pdf'}), sanitize(it.name).replace(/\.[^/.]+$/, '') + '.pdf');
        showStatus('Done ✓', false, 1400);
      } catch(err){
        console.error(err);
        showStatus('Failed to create PDF', false);
      }
    }

    function triggerDownload(blob, filename){
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=> URL.revokeObjectURL(a.href), 3000);
    }

    // ---------- wire UI ----------
    combineBtn.addEventListener('click', combineToSinglePDF);
    separateZipBtn.addEventListener('click', createSeparateZip);
    clearBtn.addEventListener('click', () => {
      // revoke any created object URLs
      items.forEach(it => { if(it.urlOrNull) try{ URL.revokeObjectURL(it.urlOrNull); }catch(e){} });
      items = [];
      render(); updateButtons(); resetProgress();
    });

    // initial state
    document.getElementById('year').textContent = new Date().getFullYear();
    updateButtons();

    // helper: sanitize used inside zip creation
    function sanitize(n){ return n.replace(/[^a-z0-9_\-\.]/gi, '_'); }

  })();
  </script>
</body>
</html>
