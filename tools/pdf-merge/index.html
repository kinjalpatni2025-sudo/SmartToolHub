<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Merge PDFs — Smarttool Hub</title>
<link rel="icon" type="image/png" href="https://img.icons8.com/fluency/48/toolbox.png"/>
<style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0;}
    header { background: #333; color: #fff; padding: 1rem; text-align: center;}
    h1 { margin: 0; font-size: 1.5rem; }
    .container { max-width: 900px; margin: 2rem auto; background: #fff; padding: 1rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
    #fileInput { margin-bottom: 1rem; }
    .file-list { list-style: none; padding: 0; }
    .file-item { display: flex; align-items: center; margin-bottom: 0.5rem; padding: 0.5rem; background: #f0f0f0; border-radius: 5px; cursor: grab; }
    .file-item img { width: 40px; height: 50px; object-fit: cover; margin-right: 1rem; }
    .file-name { flex: 1; }
    .progress { width: 100%; background: #ddd; height: 20px; border-radius: 10px; overflow: hidden; margin: 1rem 0; display: none;}
    .progress-bar { height: 100%; width: 0%; background: #4caf50; }
    button { padding: 0.5rem 1rem; border: none; border-radius: 5px; background: #4caf50; color: #fff; cursor: pointer; margin-right: 0.5rem;}
    button:disabled { background: #aaa; cursor: not-allowed; }
</style>
</head>
<body>

<header>
    <h1>Merge Multiple PDFs — Smarttool Hub</h1>
</header>

<div class="container">
    <input type="file" id="fileInput" multiple accept="application/pdf">
    <ul id="fileList" class="file-list"></ul>
    <div class="progress"><div class="progress-bar"></div></div>
    <button id="mergeBtn" disabled>Merge PDFs</button>
    <button id="downloadZipBtn" disabled>Download ZIP</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.20.0/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.11.0/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script>
const fileInput = document.getElementById('fileInput');
const fileListEl = document.getElementById('fileList');
const mergeBtn = document.getElementById('mergeBtn');
const downloadZipBtn = document.getElementById('downloadZipBtn');
const progress = document.querySelector('.progress');
const progressBar = document.querySelector('.progress-bar');

let files = [];

fileInput.addEventListener('change', async (e) => {
    files = Array.from(e.target.files);
    fileListEl.innerHTML = '';
    for (const file of files) {
        const li = document.createElement('li');
        li.className = 'file-item';
        li.dataset.name = file.name;
        
        // Create thumbnail
        const reader = new FileReader();
        const img = document.createElement('img');
        reader.onload = async function() {
            const pdfBytes = new Uint8Array(reader.result);
            const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);
            const page = pdfDoc.getPage(0);
            const pngImage = await page.render({ scale: 0.2 });
            // placeholder image
            img.src = 'https://img.icons8.com/ios-filled/50/document.png';
        };
        reader.readAsArrayBuffer(file);

        li.appendChild(img);
        const nameSpan = document.createElement('span');
        nameSpan.textContent = file.name;
        nameSpan.className = 'file-name';
        li.appendChild(nameSpan);
        fileListEl.appendChild(li);
    }
    mergeBtn.disabled = files.length < 2;
});

// Make list sortable
Sortable.create(fileListEl, { animation: 150, onEnd: () => {
    const newOrder = [];
    fileListEl.querySelectorAll('.file-item').forEach(item => {
        const f = files.find(f => f.name === item.dataset.name);
        if(f) newOrder.push(f);
    });
    files = newOrder;
}});

mergeBtn.addEventListener('click', async () => {
    if(files.length < 2) return;
    progress.style.display = 'block';
    progressBar.style.width = '0%';

    const mergedPdf = await PDFLib.PDFDocument.create();
    for(let i = 0; i < files.length; i++){
        const file = files[i];
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
        const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
        copiedPages.forEach(p => mergedPdf.addPage(p));
        progressBar.style.width = `${Math.round(((i+1)/files.length)*100)}%`;
    }
    const mergedBytes = await mergedPdf.save();
    const blob = new Blob([mergedBytes], { type: 'application/pdf' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'merged.pdf';
    link.click();

    downloadZipBtn.disabled = false;
});

downloadZipBtn.addEventListener('click', async () => {
    const zip = new JSZip();
    for(const file of files){
        zip.file(file.name, file);
    }
    const content = await zip.generateAsync({ type:"blob" });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(content);
    link.download = "merged_files.zip";
    link.click();
});
</script>

</body>
</html>
