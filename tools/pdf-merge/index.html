<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Merge Multiple PDFs — Smarttool Hub</title>
  <meta name="description" content="Merge multiple PDF files into a single PDF — upload, reorder, preview file names & page counts, and download the merged PDF. 100% client-side." />
  <meta name="keywords" content="merge pdf, pdf merge, combine pdf, online pdf merge, merge multiple pdfs" />
  <link rel="icon" href="https://img.icons8.com/fluency/48/toolbox.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    :root{
      --bg:#0b1220; --text:#eaf2ff; --card:#182335; --border:#2a3b55; --primary:#22d3ee; --muted:#9fb3c8;
    }
    body.light{--bg:#f6f8fb;--text:#0b1220;--card:#fff;--border:#e6eefc;--primary:#0b74ff;--muted:#556677}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text);transition:.22s}
    .container{max-width:1100px;margin:0 auto;padding:18px}
    header{display:flex;justify-content:space-between;align-items:center;background:var(--card);padding:12px;border-bottom:1px solid var(--border)}
    .brand a{display:flex;gap:12px;align-items:center;text-decoration:none;color:inherit}
    .brand img{width:46px;height:46px;border-radius:8px}
    .title{font-weight:700;color:var(--primary)}
    .tag{font-size:.85rem;color:var(--muted)}
    .header-actions{display:flex;gap:8px;align-items:center}
    .btn-header{border:1px solid var(--border);background:transparent;padding:8px 12px;border-radius:8px;color:var(--text);cursor:pointer;display:flex;gap:8px;align-items:center;text-decoration:none;font-weight:600}
    main{padding:18px 0}
    h1{margin:6px 0 8px;color:var(--primary)}
    .meta{color:var(--muted);margin-bottom:12px}
    .uploader{min-height:110px;border-radius:12px;border:2px dashed var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px;background:var(--card);cursor:pointer}
    .uploader:hover{border-color:var(--primary)}
    input[type=file]{display:none}
    .file-list{margin-top:16px;display:flex;flex-direction:column;gap:10px}
    .file-item{background:var(--card);border:1px solid var(--border);padding:12px;border-radius:10px;display:flex;gap:12px;align-items:center;justify-content:space-between}
    .file-left{display:flex;gap:12px;align-items:center}
    .pdf-icon{font-size:28px;color:var(--primary)}
    .file-meta{display:flex;flex-direction:column}
    .file-name{font-weight:700}
    .file-sub{color:var(--muted);font-size:.9rem}
    .file-actions{display:flex;gap:8px;align-items:center}
    .drag-handle{cursor:grab;color:var(--muted);font-size:16px;padding:6px}
    .progress{height:12px;background:var(--border);border-radius:999px;overflow:hidden;margin-top:12px}
    .progress-bar{height:100%;width:0;background:var(--primary);transition:width .2s}
    .actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
    .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--primary);color:#00131f}
    .btn-ghost{background:transparent;border:1px solid var(--border);color:var(--text)}
    .status{color:var(--muted);display:flex;align-items:center;gap:8px}
    .spinner{width:18px;height:18px;border-radius:50%;border:3px solid rgba(255,255,255,0.08);border-top-color:var(--primary);animation:spin .9s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    footer{margin-top:24px;padding:12px 0;background:var(--card);border-top:1px solid var(--border)}
    @media(max-width:820px){.file-item{flex-direction:column;align-items:flex-start}.file-actions{align-self:flex-end}}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="container">
    <div class="brand">
      <a href="../../index.html" title="Smarttool Hub home">
        <img src="https://img.icons8.com/fluency/48/toolbox.png" alt="Smarttool Hub logo">
        <div>
          <div class="title">Smarttool Hub</div>
          <div class="tag">Fast • Private • Client-side</div>
        </div>
      </a>
    </div>
    <div class="header-actions">
      <a href="../../index.html" class="btn-header"><i class="fa-solid fa-house"></i> Home</a>
      <button id="themeToggle" class="btn-header" title="Toggle theme"><i class="fa-solid fa-moon"></i></button>
    </div>
  </header>

  <main class="container">
    <h1>Merge Multiple PDFs</h1>
    <p class="meta">Upload multiple PDF files, reorder them (drag & drop), and combine every page into a single merged PDF — all in your browser. No uploads to server.</p>

    <label class="uploader" id="uploader">
      <div style="font-size:28px;color:var(--primary)"><i class="fa-solid fa-file-pdf"></i></div>
      <div style="margin-top:8px;font-weight:700">Click or drag & drop PDF files here</div>
      <div style="margin-top:6px;color:var(--muted)">Supported: .pdf — you can upload many files and reorder them before merging.</div>
      <input type="file" id="fileInput" accept="application/pdf" multiple />
    </label>

    <div class="progress" aria-hidden="true"><div class="progress-bar" id="progressBar"></div></div>

    <div class="file-list" id="fileList" aria-live="polite"></div>

    <div class="actions">
      <button id="mergeBtn" class="btn btn-primary" disabled><i class="fa-solid fa-object-group"></i> Merge into single PDF</button>
      <button id="downloadOriginalsZip" class="btn btn-ghost" disabled><i class="fa-solid fa-file-zipper"></i> Download originals (ZIP)</button>
      <button id="clearBtn" class="btn btn-ghost" disabled><i class="fa-solid fa-trash-can"></i> Clear</button>
      <div class="status" id="status"></div>
    </div>

    <section style="margin-top:18px">
      <h2 style="color:var(--primary)">How to use</h2>
      <ol>
        <li>Click or drag PDFs into the uploader.</li>
        <li>Drag items in the list to reorder them — the merge will preserve this order.</li>
        <li>Click <strong>Merge into single PDF</strong> to create and download the merged document.</li>
      </ol>
    </section>
  </main>

  <footer class="container">
    <div>© <span id="year"></span> Smarttool Hub</div>
    <div style="color:var(--muted)">Privacy • Terms • Contact</div>
  </footer>

  <!-- FAQ JSON-LD -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"Can I merge multiple PDFs?","acceptedAnswer":{"@type":"Answer","text":"Yes — upload multiple PDF files, reorder them and click merge. The merged PDF will be downloaded to your device."}},{"@type":"Question","name":"Are files uploaded to server?","acceptedAnswer":{"@type":"Answer","text":"No. All merging happens client-side in your browser."}}]}
  </script>

  <!-- Libraries -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <script>
  // ---------- Theme + year ----------
  (function(){
    const btn = document.getElementById('themeToggle');
    if(localStorage.getItem('sth_theme') === 'light'){ document.body.classList.add('light'); btn.innerHTML = '<i class="fa-solid fa-sun"></i>'; }
    btn.addEventListener('click', ()=> {
      document.body.classList.toggle('light');
      if(document.body.classList.contains('light')){ btn.innerHTML = '<i class="fa-solid fa-sun"></i>'; localStorage.setItem('sth_theme','light'); }
      else { btn.innerHTML = '<i class="fa-solid fa-moon"></i>'; localStorage.removeItem('sth_theme'); }
    });
    document.getElementById('year').textContent = new Date().getFullYear();
  })();

  // ---------- DOM refs ----------
  const uploader = document.getElementById('uploader');
  const fileInput = document.getElementById('fileInput');
  const fileList = document.getElementById('fileList');
  const mergeBtn = document.getElementById('mergeBtn');
  const downloadOriginalsZip = document.getElementById('downloadOriginalsZip');
  const clearBtn = document.getElementById('clearBtn');
  const progressBar = document.getElementById('progressBar');
  const statusEl = document.getElementById('status');

  // ---------- State ----------
  // files = [{ id, file, name, size, pageCount }]
  let files = [];

  // ---------- Helpers ----------
  function uuid(){ return Math.random().toString(36).slice(2,9); }
  function showStatus(txt, busy=false, autoMs=0){
    statusEl.textContent = txt || '';
    if(busy) statusEl.insertAdjacentHTML('afterbegin','<span class="spinner" aria-hidden="true"></span>');
    if(autoMs>0) setTimeout(()=> statusEl.textContent = '', autoMs);
  }
  function setProgress(p){ progressBar.style.width = Math.min(100,Math.max(0,Math.round(p))) + '%'; }
  function resetProgress(){ progressBar.style.width = '0%'; }
  function bytesToSize(bytes){
    if(bytes === 0) return '0 B';
    const k = 1024, sizes = ['B','KB','MB','GB','TB'];
    const i = Math.floor(Math.log(bytes)/Math.log(k));
    return parseFloat((bytes / Math.pow(k,i)).toFixed(2)) + ' ' + sizes[i];
  }
  function triggerDownload(blob, name){
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = name;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=> URL.revokeObjectURL(a.href), 3000);
  }

  // ---------- File input & drop ----------
  uploader.addEventListener('click', ()=> fileInput.click());
  uploader.addEventListener('dragover', e => { e.preventDefault(); uploader.style.borderColor = 'var(--primary)'; });
  uploader.addEventListener('dragleave', e => { uploader.style.borderColor = ''; });
  uploader.addEventListener('drop', e => { e.preventDefault(); uploader.style.borderColor = ''; handleFiles(e.dataTransfer.files); });
  fileInput.addEventListener('change', e => handleFiles(e.target.files));

  // Read PDFs, get page count using pdf-lib
  async function handleFiles(list){
    const array = Array.from(list).filter(f => f.type === 'application/pdf' || f.name.toLowerCase().endsWith('.pdf'));
    if(array.length === 0) return;
    showStatus('Reading PDFs...', true);
    // process sequentially to avoid heavy parallel memory use
    for(const f of array){
      const id = uuid();
      try{
        const arr = await f.arrayBuffer();
        const src = await PDFLib.PDFDocument.load(arr, { ignoreEncryption: true });
        const pageCount = src.getPageCount();
        files.push({ id, file: f, name: f.name, size: f.size, pageCount, arrayBuffer: arr });
      } catch(err){
        console.warn('Failed to read PDF', f.name, err);
        // still push with pageCount=0 and no arrayBuffer? skip it
        files.push({ id, file: f, name: f.name + ' (failed)', size: f.size, pageCount: 0, arrayBuffer: null, error: true });
      }
      renderList();
      updateButtons();
      await new Promise(r => setTimeout(r, 40)); // let UI breathe
    }
    showStatus('', false);
    fileInput.value = ''; // reset
  }

  // ---------- Render file list (draggable reorder) ----------
  function renderList(){
    fileList.innerHTML = '';
    if(files.length === 0){ fileList.innerHTML = '<div style="color:var(--muted)">No PDFs added yet.</div>'; return; }
    files.forEach((it, idx) => {
      const div = document.createElement('div');
      div.className = 'file-item';
      div.draggable = true;
      div.dataset.id = it.id;
      div.innerHTML = `
        <div class="file-left">
          <div class="pdf-icon"><i class="fa-solid fa-file-pdf"></i></div>
          <div class="file-meta">
            <div class="file-name">${escapeHtml(it.name)}</div>
            <div class="file-sub">${it.pageCount} pages • ${bytesToSize(it.size)}</div>
          </div>
        </div>
        <div class="file-actions">
          <div class="drag-handle" title="Drag to reorder"><i class="fa-solid fa-grip-lines"></i></div>
          <button class="btn btn-ghost remove-btn" title="Remove">Remove</button>
        </div>
      `;
      // remove handler
      div.querySelector('.remove-btn').addEventListener('click', () => {
        files = files.filter(x => x.id !== it.id);
        renderList(); updateButtons();
      });
      // drag events
      div.addEventListener('dragstart', e => { e.dataTransfer.setData('text/plain', it.id); div.style.opacity = '.6'; });
      div.addEventListener('dragend', () => div.style.opacity = '');
      div.addEventListener('dragover', e => { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; });
      div.addEventListener('drop', e => {
        e.preventDefault();
        const fromId = e.dataTransfer.getData('text/plain');
        const toId = it.id;
        if(!fromId || fromId === toId) return;
        const fromIdx = files.findIndex(x => x.id === fromId);
        const toIdx = files.findIndex(x => x.id === toId);
        if(fromIdx < 0 || toIdx < 0) return;
        const [moved] = files.splice(fromIdx, 1);
        files.splice(toIdx, 0, moved);
        renderList();
      });

      fileList.appendChild(div);
    });
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  // ---------- Buttons state ----------
  function updateButtons(){
    const has = files.length > 0;
    mergeBtn.disabled = !has;
    downloadOriginalsZip.disabled = !has;
    clearBtn.disabled = !has;
    if(has) showStatus(files.length + ' files ready', false);
    else showStatus('', false);
  }

  clearBtn.addEventListener('click', ()=>{ files = []; renderList(); updateButtons(); resetProgress(); });

  // ---------- Merge logic ----------
  mergeBtn.addEventListener('click', async () => {
    if(files.length === 0) return;
    showStatus('Merging PDFs...', true);
    setProgress(0);
    try{
      // create new PDF
      const mergedPdf = await PDFLib.PDFDocument.create();
      let totalPages = files.reduce((s,f)=>(f.pageCount||0)+s, 0);
      if(totalPages === 0){
        showStatus('No pages found in selected PDFs', false);
        return;
      }
      let processedPages = 0;

      // iterate files in current order
      for(let i=0;i<files.length;i++){
        const item = files[i];
        if(!item.arrayBuffer){
          // try to reload if arrayBuffer missing (e.g. failed earlier)
          try{ item.arrayBuffer = await item.file.arrayBuffer(); } catch(e){ continue; }
        }
        // load source PDF
        const src = await PDFLib.PDFDocument.load(item.arrayBuffer, { ignoreEncryption: true });
        const srcPageCount = src.getPageCount();
        // copy pages
        const copied = await mergedPdf.copyPages(src, Array.from({length: srcPageCount}, (_,k)=>k));
        copied.forEach((p) => mergedPdf.addPage(p));
        processedPages += srcPageCount;
        // update progress by pages proportion
        setProgress((processedPages/totalPages)*100);
        await new Promise(r=>setTimeout(r, 30)); // allow UI updates
      }

      const mergedBytes = await mergedPdf.save();
      triggerDownload(new Blob([mergedBytes], { type: 'application/pdf' }), 'merged_documents.pdf');
      showStatus('Merged PDF ready ✓', false, 2200);
    } catch(err){
      console.error('Merge failed', err);
      showStatus('Merge failed — check console', false);
    } finally { setTimeout(()=> resetProgress(), 800); }
  });

  // ---------- Download originals as ZIP ----------
  downloadOriginalsZip.addEventListener('click', async () => {
    if(files.length === 0) return;
    showStatus('Preparing ZIP...', true);
    try{
      const zip = new JSZip();
      for(let i=0;i<files.length;i++){
        const it = files[i];
        // if arrayBuffer available reuse, else read
        const arr = it.arrayBuffer || await it.file.arrayBuffer();
        zip.file(sanitize(it.name), arr);
      }
      const blob = await zip.generateAsync({ type: 'blob' }, (meta) => {
        setProgress(meta.percent);
      });
      triggerDownload(blob, 'originals.zip');
      showStatus('ZIP ready ✓', false, 2000);
    } catch(err){
      console.error(err);
      showStatus('ZIP creation failed', false);
    } finally { setTimeout(()=> resetProgress(), 700); }
  });

  // helper sanitize
  function sanitize(name){ return name.replace(/[^a-z0-9_\-\.]/gi, '_'); }

  // initial
  renderList();
  updateButtons();

  </script>
</body>
</html>
