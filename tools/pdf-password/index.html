<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Password Encrypt / Decrypt PDF - Smarttool Hub (Client-side)</title>
  <meta name="description" content="Encrypt and decrypt PDF files fully client-side (no API key). Generate encrypted .enc files and decrypt them back to PDF."/>
  <link rel="icon" href="https://img.icons8.com/fluency/48/toolbox.png"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <style>
    :root{
      --bg:#0b1220;--text:#eaf2ff;--card:#182335;--border:#2a3b55;
      --primary:#22d3ee;--muted:#9fb3c8;--radius:12px;
    }
    body.light{
      --bg:#f6f8fb;--text:#0b1220;--card:#ffffff;--border:#e6eefc;
      --primary:#0b74ff;--muted:#556677;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg);color:var(--text);transition:background .25s,color .25s;
      min-height:100vh;display:flex;flex-direction:column;
    }
    .container{max-width:1200px;margin:0 auto;padding:20px;width:100%}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      background:var(--card);border-bottom:1px solid var(--border);padding:14px 20px;
      position:sticky;top:0;z-index:20;
    }
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:46px;height:46px;border-radius:10px}
    .brand .title{font-size:1.25rem;font-weight:700;color:var(--primary);margin:0}
    .brand .tag{font-size:.9rem;color:var(--muted)}
    .header-actions{display:flex;gap:10px;align-items:center}
    .btn-header{
      border:1px solid var(--border);background:transparent;padding:8px 12px;border-radius:8px;
      color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;text-decoration:none;font-weight:600
    }
    .btn-header:hover{border-color:var(--primary);color:var(--primary)}
    
    /* Tool-specific styles */
    .tool-content {
      background:var(--card);border-radius:var(--radius);border:1px solid var(--border);
      padding:25px;margin-top:20px;
    }
    .tool-title {
      font-size:1.8rem;margin-bottom:5px;color:var(--primary);
    }
    .tool-description {
      color:var(--muted);margin-bottom:18px;
    }
    .split {
      display:grid;grid-template-columns:1fr 1fr;gap:20px;
    }
    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));
      border:1px solid var(--border);padding:18px;border-radius:12px;
    }
    label{display:block;margin-bottom:8px;font-weight:600;color:var(--text)}
    input[type="file"]{display:block;margin-bottom:12px}
    .input{width:100%;padding:10px 12px;border-radius:10px;background:transparent;border:1px solid var(--border);color:var(--text)}
    .muted{color:var(--muted);font-size:0.92rem}
    .row{display:flex;gap:12px;align-items:center;margin-top:12px}
    .col{flex:1}
    .btn{
      padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer;
    }
    .btn-primary{background:var(--primary);color:#00131f}
    .btn-secondary{background:transparent;border:1px solid var(--border);color:var(--text)}
    .status{margin-top:12px;padding:10px;border-radius:10px;background:var(--bg);border:1px solid var(--border);color:var(--muted)}
    pre.log{background:#07101a;padding:10px;border-radius:8px;overflow:auto;color:#a7c7e6;height:120px}
    footer{margin-top:auto;padding:18px 0;background:var(--card);border-top:1px solid var(--border)}
    .footer-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .footer-links{display:flex;gap:14px;flex-wrap:wrap}
    .footer-links a{color:var(--primary);text-decoration:none;font-weight:600}
    @media (max-width:900px){
      .split{grid-template-columns:1fr}
      header{flex-direction:column;align-items:flex-start}
    }
  </style>
</head>
<body>
<header class="container">
  <div class="brand">
    <a href="#" style="display:flex;align-items:center;gap:12px;text-decoration:none;">
      <img src="https://img.icons8.com/fluency/48/toolbox.png" alt="Smarttool Hub Logo">
      <div>
        <div class="title">Smarttool Hub</div>
        <div class="tag">Offline • Private • Client-side</div>
      </div>
    </a>
  </div>
  <div class="header-actions">
    <a href="#" class="btn-header"><i class="fa-solid fa-house"></i> Home</a>
    <button class="btn-header" id="themeToggle" title="Toggle dark/light mode"><i class="fa-solid fa-moon"></i></button>
  </div>
</header>

<main class="container">
  <div class="tool-content">
    <h1 class="tool-title">Encrypt & Decrypt PDF (Client-side)</h1>
    <p class="tool-description">No API key required. Encrypt PDFs into a secure `.enc` file using AES-GCM, and decrypt them back to PDF using the same page.</p>

    <div class="split">
      <!-- Encrypt Panel -->
      <div class="panel" id="encryptPanel">
        <h2 style="margin:0 0 8px;color:var(--primary)">Encrypt PDF</h2>
        <p class="muted">Select a PDF, choose a password, and download an encrypted .enc file. Keep the password safe.</p>
        <label for="encFile">Choose PDF file</label>
        <input id="encFile" type="file" accept="application/pdf">
        <label for="encPassword">Password</label>
        <input id="encPassword" class="input" type="password" placeholder="Enter strong password">
        <label for="encFilename">Output filename</label>
        <input id="encFilename" class="input" type="text" placeholder="my-document.enc">
        <div class="row" style="margin-top:14px">
          <button id="encryptBtn" class="btn btn-primary"><i class="fa-solid fa-lock"></i> Encrypt & Download</button>
          <button id="clearEnc" class="btn btn-secondary"><i class="fa-solid fa-eraser"></i> Clear</button>
        </div>
        <div id="encStatus" class="status" style="display:none;margin-top:12px"></div>
      </div>

      <!-- Decrypt Panel -->
      <div class="panel" id="decryptPanel">
        <h2 style="margin:0 0 8px;color:var(--primary)">Decrypt .enc → PDF</h2>
        <p class="muted">Select the encrypted file and enter the password to recover the original PDF.</p>
        <label for="decFile">Choose .enc file</label>
        <input id="decFile" type="file" accept=".enc,application/octet-stream">
        <label for="decPassword">Password</label>
        <input id="decPassword" class="input" type="password" placeholder="Enter password used for encryption">
        <label for="decFilename">Output filename</label>
        <input id="decFilename" class="input" type="text" placeholder="original.pdf">
        <div class="row" style="margin-top:14px">
          <button id="decryptBtn" class="btn btn-primary"><i class="fa-solid fa-unlock"></i> Decrypt & Download</button>
          <button id="clearDec" class="btn btn-secondary"><i class="fa-solid fa-eraser"></i> Clear</button>
        </div>
        <div id="decStatus" class="status" style="display:none;margin-top:12px"></div>
      </div>
    </div>

    <div style="margin-top:18px" class="panel">
      <h3 style="margin:0 0 8px;color:var(--primary)">How this works</h3>
      <ul class="muted">
        <li>We derive a key from your password using PBKDF2 and encrypt with AES-GCM (Web Crypto API).</li>
        <li>The encrypted file stores: <code>salt (16 bytes) + iv (12 bytes) + ciphertext</code>.</li>
        <li>This is NOT an Adobe-compatible password — recipients must decrypt using this tool to get the original PDF.</li>
      </ul>
      <div style="margin-top:12px">
        <strong>Logs / status:</strong>
        <pre id="log" class="log">Ready.</pre>
      </div>
    </div>
  </div>
</main>

<footer class="container">
  <div class="footer-inner">
    <div>© <span id="year"></span> Smarttool Hub</div>
    <div class="footer-links">
      <a href="#">Privacy</a>
      <a href="#">Terms</a>
      <a href="#">Contact</a>
    </div>
  </div>
</footer>

<script>
  // UI elements
  const encFileEl = document.getElementById('encFile');
  const encPassEl = document.getElementById('encPassword');
  const encNameEl = document.getElementById('encFilename');
  const encryptBtn = document.getElementById('encryptBtn');
  const clearEncBtn = document.getElementById('clearEnc');
  const encStatus = document.getElementById('encStatus');

  const decFileEl = document.getElementById('decFile');
  const decPassEl = document.getElementById('decPassword');
  const decNameEl = document.getElementById('decFilename');
  const decryptBtn = document.getElementById('decryptBtn');
  const clearDecBtn = document.getElementById('clearDec');
  const decStatus = document.getElementById('decStatus');

  const logEl = document.getElementById('log');
  const yearEl = document.getElementById('year');
  yearEl.textContent = new Date().getFullYear();

  // theme toggle
  const themeToggle = document.getElementById('themeToggle');
  if (localStorage.getItem('sth_theme') === 'light') {
    document.body.classList.add('light');
    themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
  }
  themeToggle.onclick = () => {
    document.body.classList.toggle('light');
    if (document.body.classList.contains('light')) {
      themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
      localStorage.setItem('sth_theme', 'light');
    } else {
      themeToggle.innerHTML = '<i class="fa-solid fa-moon"></i>';
      localStorage.removeItem('sth_theme');
    }
  };

  function log(msg){
    const t = new Date().toLocaleTimeString();
    logEl.textContent = `[${t}] ${msg}\\n` + logEl.textContent;
  }

  function showStatus(el, msg, isError=false){
    el.style.display = 'block';
    el.textContent = msg;
    el.style.borderColor = isError ? '#ef4444' : '#10b981';
    el.style.color = isError ? '#ef4444' : '#10b981';
    if (!isError) {
      setTimeout(()=>{ el.style.display = 'none'; }, 6000);
    }
  }

  // ===== Web Crypto helpers =====
  function str2ab(str){ return new TextEncoder().encode(str); }
  async function deriveKey(password, salt, iterations=200000, keyLen=256){
    const pwKey = await crypto.subtle.importKey('raw', str2ab(password), {name:'PBKDF2'}, false, ['deriveKey']);
    const derived = await crypto.subtle.deriveKey({
      name:'PBKDF2',
      salt: salt,
      iterations: iterations,
      hash: 'SHA-256'
    }, pwKey, {name:'AES-GCM', length: keyLen}, false, ['encrypt','decrypt']);
    return derived;
  }
  function randBytes(len){ return crypto.getRandomValues(new Uint8Array(len)); }

  async function encryptBuffer(buffer, password){
    const salt = randBytes(16); // 16 bytes
    const iv = randBytes(12);   // 12 bytes for AES-GCM
    const key = await deriveKey(password, salt);
    const cipher = await crypto.subtle.encrypt({name:'AES-GCM', iv: iv}, key, buffer);
    const cipherU8 = new Uint8Array(cipher);
    const out = new Uint8Array(salt.byteLength + iv.byteLength + cipherU8.byteLength);
    out.set(salt, 0);
    out.set(iv, salt.byteLength);
    out.set(cipherU8, salt.byteLength + iv.byteLength);
    return out;
  }

  async function decryptBuffer(packedU8, password){
    if (packedU8.length < 28) throw new Error('File too small or corrupted');
    const salt = packedU8.slice(0,16);
    const iv = packedU8.slice(16,28);
    const ciphertext = packedU8.slice(28);
    const key = await deriveKey(password, salt);
    const plain = await crypto.subtle.decrypt({name:'AES-GCM', iv: iv}, key, ciphertext);
    return plain;
  }

  function downloadBlob(blob, filename){
    const a = document.createElement('a');
    const url = URL.createObjectURL(blob);
    a.href = url; a.download = filename || 'file';
    document.body.appendChild(a); a.click();
    setTimeout(()=>{ document.body.removeChild(a); URL.revokeObjectURL(url); }, 200);
  }

  // ===== Encrypt flow =====
  encryptBtn.addEventListener('click', async ()=>{
    try{
      const file = encFileEl.files[0];
      const password = encPassEl.value;
      if (!file) { alert('Please select a PDF file to encrypt'); return; }
      if (!password || password.length < 4) { alert('Please enter a password (min 4 chars recommended)'); return; }
      encStatus.style.display = 'block'; encStatus.textContent = 'Reading file...';
      log('Reading file: ' + file.name);
      const arrayBuffer = await file.arrayBuffer();
      encStatus.textContent = 'Encrypting (this may take a moment)...';
      log('Encrypting with PBKDF2 + AES-GCM...');
      const packed = await encryptBuffer(arrayBuffer, password);
      const outName = encNameEl.value ? encNameEl.value.trim() : (file.name + '.enc');
      const blob = new Blob([packed], {type: 'application/octet-stream'});
      downloadBlob(blob, outName);
      showStatus(encStatus, 'Encryption complete — downloaded: ' + outName, false);
      log('Encryption finished: ' + outName);
    } catch (err) {
      console.error(err);
      showStatus(encStatus, 'Encryption failed: ' + (err.message||err), true);
      log('Encryption error: ' + (err.message||err));
    }
  });

  clearEncBtn.addEventListener('click', ()=>{
    encFileEl.value=''; encPassEl.value=''; encNameEl.value=''; encStatus.style.display='none';
    log('Encryption inputs cleared');
  });

  // ===== Decrypt flow =====
  decryptBtn.addEventListener('click', async ()=>{
    try{
      const file = decFileEl.files[0];
      const password = decPassEl.value;
      if (!file) { alert('Please select an encrypted (.enc) file to decrypt'); return; }
      if (!password) { alert('Please enter the password'); return; }
      decStatus.style.display = 'block'; decStatus.textContent = 'Reading encrypted file...';
      log('Reading encrypted file: ' + file.name);
      const packed = new Uint8Array(await file.arrayBuffer());
      decStatus.textContent = 'Decrypting (this may take a moment)...';
      log('Attempting decrypt...');
      const plain = await decryptBuffer(packed, password);
      const outName = decNameEl.value ? decNameEl.value.trim() : 'decrypted.pdf';
      const blob = new Blob([plain], {type: 'application/pdf'});
      downloadBlob(blob, outName);
      showStatus(decStatus, 'Decryption complete — downloaded: ' + outName, false);
      log('Decryption succeeded: ' + outName);
    } catch (err) {
      console.error(err);
      showStatus(decStatus, 'Decryption failed — wrong password or corrupted file.', true);
      log('Decryption error: ' + (err.message||err));
      alert('Decryption failed — wrong password or corrupted file.');
    }
  });

  clearDecBtn.addEventListener('click', ()=>{
    decFileEl.value=''; decPassEl.value=''; decNameEl.value=''; decStatus.style.display='none';
    log('Decryption inputs cleared');
  });
</script>
</body>
</html>
