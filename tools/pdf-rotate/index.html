<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rotate PDF Pages - Smarttool Hub</title>
  <meta name="description" content="Rotate pages of PDF files in the browser. Per-page rotation, rotate all, download rotated PDF or merge rotated pages." />
  <link rel="icon" href="https://img.icons8.com/fluency/48/toolbox.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <style>
    /* EXACT design language reused from your uploaded tools */
    :root{--bg:#0b1220;--text:#eaf2ff;--card:#182335;--border:#2a3b55;--primary:#22d3ee;--muted:#9fb3c8;--radius:12px}
    body.light{--bg:#f6f8fb;--text:#0b1220;--card:#ffffff;--border:#e6eefc;--primary:#0b74ff;--muted:#556677}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto, "Helvetica Neue", Arial;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;transition:background .25s,color .25s}
    .container{max-width:1200px;margin:0 auto;padding:20px;width:100%}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;background:var(--card);border-bottom:1px solid var(--border);padding:14px 20px}
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:46px;height:46px;border-radius:10px}
    .brand .title{font-size:1.25rem;font-weight:700;color:var(--primary);margin:0}
    .brand .tag{font-size:.9rem;color:var(--muted)}
    .header-actions{display:flex;gap:10px;align-items:center}
    .btn-header{border:1px solid var(--border);background:transparent;padding:8px 12px;border-radius:8px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;text-decoration:none;font-weight:600}
    .btn-header:hover{border-color:var(--primary);color:var(--primary)}

    .tool-content { background:var(--card);border-radius:var(--radius);border:1px solid var(--border);padding:25px;margin-top:20px; }
    .tool-title { font-size:1.8rem;margin-bottom:5px;color:var(--primary); }
    .tool-description { color:var(--muted);margin-bottom:18px; }

    .upload-area { border:2px dashed var(--border);border-radius:var(--radius);padding:30px;text-align:center;margin-bottom:20px;transition:all 0.3s;cursor:pointer;background:var(--bg); }
    .upload-area:hover, .upload-area.dragover { border-color:var(--primary);background:rgba(34,211,238,0.03); }
    .upload-icon { font-size:3rem;color:var(--muted);margin-bottom:12px; }
    .upload-text { color:var(--text);margin-bottom:10px;font-weight:600; }
    .upload-subtext { color:var(--muted);font-size:0.9rem; }
    .file-input { display:none; }

    .selected-list { display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:12px;margin-bottom:18px; }
    .file-card { background:var(--bg);border:1px solid var(--border);padding:12px;border-radius:10px;display:flex;gap:12px;align-items:flex-start; }
    .pdf-icon { width:86px;height:86px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#0f1720;border:1px solid var(--border);font-size:2rem;color:var(--primary) }
    .file-meta { flex:1 }
    .file-meta h5{margin:0 0 6px 0;font-size:0.95rem;color:var(--text)}
    .file-meta p{margin:0;color:var(--muted);font-size:0.88rem}
    .file-actions { display:flex;flex-direction:column;gap:8px;min-width:140px; }
    .small-btn { padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:600 }
    .small-btn.primary { background:var(--primary);color:#00131f }
    .small-btn.secondary { background:var(--card);border:1px solid var(--border);color:var(--text) }

    .page-list { margin-top:10px; display:flex;flex-direction:column; gap:8px; max-height:260px; overflow:auto; }
    .page-item { display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid var(--border);background:var(--card);gap:8px }
    .rot-badge { font-size:0.85rem;background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:8px;border:1px solid var(--border);color:var(--muted); }

    .page-controls { display:flex;gap:8px;align-items:center; }
    .page-controls button { padding:6px 8px;border-radius:8px;border:none;background:var(--card);color:var(--text);cursor:pointer;border:1px solid var(--border); }
    .page-controls button.primary { background:var(--primary);color:#00131f;border-color:var(--primary); }

    .action-buttons { display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px;align-items:center; }
    .btn { padding:12px 20px;border-radius:var(--radius);border:none;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px; }
    .btn-primary { background:var(--primary);color:#00131f; }
    .btn-secondary { background:var(--card);color:var(--text);border:1px solid var(--border); }
    .btn:disabled { opacity:0.6;cursor:not-allowed; }

    .status-message { margin-top:15px;padding:10px;border-radius:var(--radius);background:var(--bg);border:1px solid var(--border);color:var(--muted);font-size:0.9rem;display:none; }
    .status-success { border-color:#10b981;color:#10b981; }
    .status-error { border-color:#ef4444;color:#ef4444; }

    footer{margin-top:auto;padding:18px 0;background:var(--card);border-top:1px solid var(--border)}
    .footer-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .footer-links{display:flex;gap:14px;flex-wrap:wrap}
    .footer-links a{color:var(--primary);text-decoration:none;font-weight:600}

    @media (max-width:720px){
      header{flex-direction:column;align-items:flex-start;gap:10px}
      .header-actions{align-self:flex-end}
      .action-buttons{flex-direction:column}
      .btn{width:100%;justify-content:center}
    }
  </style>
</head>
<body>
  <header class="container">
    <div class="brand">
      <a href="index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;">
        <img src="https://img.icons8.com/fluency/48/toolbox.png" alt="Smarttool Hub Logo">
        <div>
          <div class="title">Smarttool Hub</div>
          <div class="tag">Fast • Private • 100% Client-side</div>
        </div>
      </a>
    </div>
    <div class="header-actions">
      <a href="index.html" class="btn-header"><i class="fa-solid fa-house"></i> Home</a>
      <button class="btn-header" id="themeToggle" title="Toggle dark/light mode"><i class="fa-solid fa-moon"></i></button>
    </div>
  </header>

  <main class="container">
    <div class="tool-content">
      <h1 class="tool-title">Rotate PDF Pages</h1>
      <p class="tool-description">Upload PDF(s), rotate pages (per-page or all pages), then download rotated PDFs or merge rotated pages. All in-browser.</p>

      <div class="upload-area" id="uploadArea" title="Click or drop PDF files here to add multiple files">
        <div class="upload-icon"><i class="fas fa-file-pdf"></i></div>
        <div class="upload-text">Drop PDF files here or click to browse</div>
        <div class="upload-subtext">Supports multiple PDF files. Rotate pages by 90° increments.</div>
        <input type="file" id="fileInput" class="file-input" accept="application/pdf" multiple>
      </div>

      <div id="selectedList" class="selected-list" aria-live="polite"></div>

      <div class="action-buttons">
        <button class="btn btn-primary" id="downloadAllMergedBtn" disabled><i class="fas fa-download"></i> Download All Rotated (Merged PDF)</button>
        <button class="btn btn-secondary" id="resetBtn"><i class="fas fa-redo"></i> Reset</button>
        <div style="margin-left:auto;color:var(--muted);font-weight:600" id="summaryText">No files selected</div>
      </div>

      <div id="statusMessage" class="status-message"></div>
    </div>
  </main>

  <footer class="container">
    <div class="footer-inner">
      <div>© <span id="year"></span> Smarttool Hub</div>
      <div class="footer-links">
        <a href="privacy.html">Privacy</a>
        <a href="terms.html">Terms</a>
        <a href="contact.html">Contact</a>
      </div>
    </div>
  </footer>

  <!-- pdf-lib -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>

  <script>
    // Initialization & theme
    document.getElementById('year').textContent = new Date().getFullYear();
    const themeToggle = document.getElementById('themeToggle');
    if (localStorage.getItem('sth_theme') === 'light') { document.body.classList.add('light'); themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>'; }
    themeToggle.onclick = () => {
      document.body.classList.toggle('light');
      if (document.body.classList.contains('light')) { themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>'; localStorage.setItem('sth_theme','light'); }
      else { themeToggle.innerHTML = '<i class="fa-solid fa-moon"></i>'; localStorage.removeItem('sth_theme'); }
    };

    // Elements
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const selectedList = document.getElementById('selectedList');
    const downloadAllMergedBtn = document.getElementById('downloadAllMergedBtn');
    const resetBtn = document.getElementById('resetBtn');
    const summaryText = document.getElementById('summaryText');
    const statusMessage = document.getElementById('statusMessage');

    // State
    // filesState: [{id, file, arrayBuffer, pageCount, rotations: [0|90|180|270]}]
    let filesState = [];

    // Helpers
    function uid(){ return 'f_' + Math.random().toString(36).slice(2,9); }
    function isPdf(f){ return f && (f.type === 'application/pdf' || /\.pdf$/i.test(f.name)); }
    function showStatus(msg, type='success', autoHide=true){
      statusMessage.textContent = msg;
      statusMessage.classList.remove('status-success','status-error');
      statusMessage.style.display = 'block';
      if (type === 'success') statusMessage.classList.add('status-success');
      if (type === 'error') statusMessage.classList.add('status-error');
      if (autoHide) setTimeout(()=> statusMessage.style.display='none', 4500);
    }
    function formatFileSize(bytes){ if (!bytes) return '0 KB'; return (bytes/1024).toFixed(1) + ' KB'; }

    // Upload handlers
    uploadArea.addEventListener('click', ()=> fileInput.click());
    uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
    uploadArea.addEventListener('dragleave', e => { e.preventDefault(); uploadArea.classList.remove('dragover'); });
    uploadArea.addEventListener('drop', e => { e.preventDefault(); uploadArea.classList.remove('dragover'); handleFilesAdded(Array.from(e.dataTransfer.files || [])); });
    fileInput.addEventListener('change', e => { handleFilesAdded(Array.from(e.target.files || [])); fileInput.value = ''; });

    async function handleFilesAdded(list) {
      const incoming = list.filter(isPdf);
      const rejected = list.filter(f => !isPdf(f));
      if (rejected.length) showStatus(`${rejected.length} non-PDF file(s) ignored`, 'error');
      if (!incoming.length) return;

      for (const file of incoming) {
        const id = uid();
        const entry = { id, file, arrayBuffer: null, pageCount: null, rotations: [] };
        filesState.push(entry);
        try {
          const ab = await file.arrayBuffer();
          entry.arrayBuffer = ab;
          try {
            const pdfDoc = await PDFLib.PDFDocument.load(ab, { ignoreEncryption: true });
            entry.pageCount = pdfDoc.getPageCount();
            entry.rotations = new Array(entry.pageCount).fill(0); // 0 degrees initial
          } catch (err) {
            console.warn('Could not read PDF page count', file.name, err);
            entry.pageCount = null;
            entry.rotations = [];
          }
        } catch (err) {
          console.error('Failed to read file', file.name, err);
          showStatus(`Failed to read ${file.name}`, 'error');
        }
      }

      renderFileCards();
      updateControls();
      showStatus(`${incoming.length} file(s) added`, 'success');
    }

    // Render UI
    function renderFileCards() {
      selectedList.innerHTML = '';
      filesState.forEach((entry, fileIndex) => {
        const file = entry.file;
        const card = document.createElement('div'); card.className = 'file-card'; card.id = 'card-'+entry.id;

        const icon = document.createElement('div'); icon.className = 'pdf-icon'; icon.innerHTML = '<i class="fa-solid fa-file-pdf"></i>';
        card.appendChild(icon);

        const meta = document.createElement('div'); meta.className = 'file-meta';
        const h5 = document.createElement('h5'); h5.textContent = file.name; meta.appendChild(h5);
        const p1 = document.createElement('p'); p1.textContent = `${formatFileSize(file.size)} • ${entry.pageCount ? entry.pageCount + ' page(s)' : 'Unknown pages'}`; meta.appendChild(p1);

        // page list with rotation controls
        const pageList = document.createElement('div'); pageList.className = 'page-list';
        if (entry.pageCount && entry.rotations.length === entry.pageCount) {
          for (let p = 0; p < entry.pageCount; p++) {
            const item = document.createElement('div'); item.className = 'page-item';
            const left = document.createElement('div'); left.textContent = `Page ${p+1}`;
            const right = document.createElement('div'); right.style.display='flex'; right.style.gap='8px'; right.style.alignItems='center';

            const rotBadge = document.createElement('div'); rotBadge.className = 'rot-badge'; rotBadge.textContent = `${entry.rotations[p]}°`;
            const controls = document.createElement('div'); controls.className = 'page-controls';
            const ccwBtn = document.createElement('button'); ccwBtn.title = 'Rotate -90°'; ccwBtn.innerHTML = '<i class="fa-solid fa-rotate-left"></i>';
            ccwBtn.onclick = () => { entry.rotations[p] = (entry.rotations[p] + 270) % 360; renderFileCards(); updateControls(); };
            const cwBtn = document.createElement('button'); cwBtn.className='primary'; cwBtn.title = 'Rotate +90°'; cwBtn.innerHTML = '<i class="fa-solid fa-rotate-right"></i>';
            cwBtn.onclick = () => { entry.rotations[p] = (entry.rotations[p] + 90) % 360; renderFileCards(); updateControls(); };

            // reset rotation for this page
            const resetBtn = document.createElement('button'); resetBtn.title='Reset rotation'; resetBtn.innerHTML = '<i class="fa-solid fa-undo"></i>';
            resetBtn.onclick = () => { entry.rotations[p] = 0; renderFileCards(); updateControls(); };

            // download single rotated page
            const dlBtn = document.createElement('button'); dlBtn.className='small-btn primary'; dlBtn.title='Download this rotated page as PDF'; dlBtn.innerHTML = '<i class="fa-solid fa-download"></i>';
            dlBtn.onclick = async () => { await downloadRotatedSinglePage(entry, p); };

            controls.appendChild(ccwBtn); controls.appendChild(rotBadge); controls.appendChild(cwBtn); controls.appendChild(resetBtn);
            right.appendChild(controls); right.appendChild(dlBtn);

            item.appendChild(left); item.appendChild(right);
            pageList.appendChild(item);
          }

          // quick actions: rotate all pages left/right and reset all
          const quick = document.createElement('div'); quick.style.display='flex'; quick.style.gap='8px'; quick.style.marginTop='8px';
          const rotateAllLeft = document.createElement('button'); rotateAllLeft.className='small-btn secondary'; rotateAllLeft.textContent='Rotate All -90°';
          rotateAllLeft.onclick = () => { entry.rotations = entry.rotations.map(r => (r + 270) % 360); renderFileCards(); updateControls(); };
          const rotateAllRight = document.createElement('button'); rotateAllRight.className='small-btn primary'; rotateAllRight.textContent='Rotate All +90°';
          rotateAllRight.onclick = () => { entry.rotations = entry.rotations.map(r => (r + 90) % 360); renderFileCards(); updateControls(); };
          const resetAll = document.createElement('button'); resetAll.className='small-btn secondary'; resetAll.textContent='Reset All';
          resetAll.onclick = () => { entry.rotations = entry.rotations.map(_=>0); renderFileCards(); updateControls(); };
          quick.appendChild(rotateAllLeft); quick.appendChild(rotateAllRight); quick.appendChild(resetAll);
          pageList.appendChild(quick);
        } else {
          const msg = document.createElement('div'); msg.style.color='var(--muted)'; msg.textContent = 'Page info not available';
          pageList.appendChild(msg);
        }
        meta.appendChild(pageList);
        card.appendChild(meta);

        const actions = document.createElement('div'); actions.className='file-actions';
        const downloadRotatedBtn = document.createElement('button'); downloadRotatedBtn.className='small-btn primary'; downloadRotatedBtn.innerHTML = '<i class="fa-solid fa-download"></i> Download Rotated';
        downloadRotatedBtn.title = 'Download this file with applied rotations';
        downloadRotatedBtn.onclick = async () => { await downloadRotatedForEntry(entry); };

        const infoBtn = document.createElement('button'); infoBtn.className='small-btn secondary'; infoBtn.innerHTML = '<i class="fa-solid fa-info"></i>';
        infoBtn.onclick = () => { alert(`${file.name}\nSize: ${formatFileSize(file.size)}\nPages: ${entry.pageCount || 'Unknown'}`); };

        const removeFileBtn = document.createElement('button'); removeFileBtn.className='small-btn secondary'; removeFileBtn.innerHTML = '<i class="fa-solid fa-trash"></i>';
        removeFileBtn.onclick = () => { filesState = filesState.filter(f => f.id !== entry.id); renderFileCards(); updateControls(); showStatus('File removed', 'success'); };

        actions.appendChild(downloadRotatedBtn); actions.appendChild(infoBtn); actions.appendChild(removeFileBtn);
        card.appendChild(actions);

        selectedList.appendChild(card);
      });

      summaryText.textContent = filesState.length ? `${filesState.length} file(s) selected` : 'No files selected';
    }

    function updateControls() {
      const anyFiles = filesState.length > 0;
      // enable merged download when at least one file exists
      downloadAllMergedBtn.disabled = !anyFiles;
    }

    // Download single rotated page as a single-page PDF
    async function downloadRotatedSinglePage(entry, pIndex) {
      if (typeof PDFLib === 'undefined') { showStatus('pdf-lib not loaded', 'error'); return; }
      try {
        const srcPdf = await PDFLib.PDFDocument.load(entry.arrayBuffer, { ignoreEncryption: true });
        const newPdf = await PDFLib.PDFDocument.create();
        const [copied] = await newPdf.copyPages(srcPdf, [pIndex]);
        // set rotation if any
        const deg = entry.rotations[pIndex] || 0;
        if (deg) copied.setRotation(PDFLib.degrees(deg));
        newPdf.addPage(copied);
        const bytes = await newPdf.save();
        const blob = new Blob([bytes], { type: 'application/pdf' });
        const name = `${entry.file.name.replace(/\.pdf$/i,'')}_page-${pIndex+1}_rotated.pdf`;
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = name; document.body.appendChild(a); a.click();
        setTimeout(()=> { URL.revokeObjectURL(url); try{document.body.removeChild(a);}catch(e){} }, 300);
        showStatus(`Downloaded page ${pIndex+1} (rotated ${deg}°)`, 'success');
      } catch (err) {
        console.error('downloadRotatedSinglePage failed', err);
        showStatus('Failed to download page', 'error');
      }
    }

    // Download rotated PDF for a single entry (apply rotations to pages and save)
    async function downloadRotatedForEntry(entry) {
      if (typeof PDFLib === 'undefined') { showStatus('pdf-lib not loaded', 'error'); return; }
      if (!entry.pageCount) { showStatus('No page info', 'error'); return; }

      showStatus('Preparing rotated PDF...', 'success', false);
      try {
        const srcPdf = await PDFLib.PDFDocument.load(entry.arrayBuffer, { ignoreEncryption: true });
        const newPdf = await PDFLib.PDFDocument.create();
        const indices = Array.from({length: entry.pageCount}, (_,i) => i);
        const copied = await newPdf.copyPages(srcPdf, indices);
        for (let i = 0; i < copied.length; i++) {
          const p = copied[i];
          const deg = entry.rotations[i] || 0;
          if (deg) p.setRotation(PDFLib.degrees(deg));
          newPdf.addPage(p);
        }
        const bytes = await newPdf.save();
        const blob = new Blob([bytes], { type: 'application/pdf' });
        const name = `${entry.file.name.replace(/\.pdf$/i,'')}_rotated.pdf`;
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = name; document.body.appendChild(a); a.click();
        setTimeout(()=> { URL.revokeObjectURL(url); try{document.body.removeChild(a);}catch(e){} }, 400);
        showStatus('Rotated PDF downloaded', 'success');
      } catch (err) {
        console.error('downloadRotatedForEntry failed', err);
        showStatus('Failed to prepare rotated PDF', 'error');
      }
    }

    // Merge rotated pages from all files into single PDF and download
    async function downloadAllRotatedMerged() {
      if (typeof PDFLib === 'undefined') { showStatus('pdf-lib not loaded', 'error'); return; }
      if (!filesState.length) { showStatus('No files to process', 'error'); return; }

      showStatus('Merging rotated pages — please wait...', 'success', false);
      try {
        const mergedPdf = await PDFLib.PDFDocument.create();

        for (let i = 0; i < filesState.length; i++) {
          const entry = filesState[i];
          if (!entry.pageCount) continue;
          const srcPdf = await PDFLib.PDFDocument.load(entry.arrayBuffer, { ignoreEncryption: true });
          // copy all pages
          const indices = Array.from({length: entry.pageCount}, (_,idx) => idx);
          const copied = await mergedPdf.copyPages(srcPdf, indices);
          // copied pages correspond to indices order
          for (let j = 0; j < copied.length; j++) {
            const p = copied[j];
            const deg = entry.rotations[j] || 0;
            if (deg) p.setRotation(PDFLib.degrees(deg));
            mergedPdf.addPage(p);
          }
        }

        const bytes = await mergedPdf.save();
        const blob = new Blob([bytes], { type: 'application/pdf' });
        const ts = new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
        const name = `merged_rotated_${ts}.pdf`;
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = name; document.body.appendChild(a); a.click();
        setTimeout(()=> { URL.revokeObjectURL(url); try{document.body.removeChild(a);}catch(e){} }, 500);
        showStatus('Merged rotated PDF downloaded', 'success');
      } catch (err) {
        console.error('downloadAllRotatedMerged failed', err);
        showStatus('Failed to merge rotated pages', 'error');
      }
    }

    // Reset
    resetBtn.addEventListener('click', () => {
      filesState = [];
      selectedList.innerHTML = '';
      downloadAllMergedBtn.disabled = true;
      showStatus('Reset complete', 'success');
      summaryText.textContent = 'No files selected';
    });

    downloadAllMergedBtn.addEventListener('click', downloadAllRotatedMerged);

    // keyboard accessible
    uploadArea.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); } });

    // initial
    (function init(){ summaryText.textContent = 'No files selected'; updateControls(); })();
  </script>
</body>
</html>
