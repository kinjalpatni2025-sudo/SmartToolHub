<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rotate PDF Pages - Smarttool Hub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    :root{--bg:#0b1220;--text:#eaf2ff;--card:#182335;--border:#2a3b55;--primary:#22d3ee;--muted:#9fb3c8;--radius:12px}
    body.light{--bg:#f6f8fb;--text:#0b1220;--card:#ffffff;--border:#e6eefc;--primary:#0b74ff;--muted:#556677}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column}
    .container{max-width:1200px;margin:0 auto;padding:20px;width:100%}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;background:var(--card);border-bottom:1px solid var(--border);padding:14px 20px}
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:46px;height:46px;border-radius:10px}
    .brand .title{font-size:1.25rem;font-weight:700;color:var(--primary)}
    .brand .tag{font-size:.9rem;color:var(--muted)}
    .btn-header{border:1px solid var(--border);background:transparent;padding:8px 12px;border-radius:8px;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;text-decoration:none;font-weight:600}
    .btn-header:hover{border-color:var(--primary);color:var(--primary)}
    .tool-content{background:var(--card);border-radius:var(--radius);border:1px solid var(--border);padding:25px;margin-top:20px}
    .tool-title{font-size:1.8rem;margin-bottom:5px;color:var(--primary)}
    .tool-description{color:var(--muted);margin-bottom:20px}
    .upload-area{border:2px dashed var(--border);border-radius:var(--radius);padding:40px;text-align:center;margin-bottom:25px;cursor:pointer;background:var(--bg);transition:all .18s}
    .upload-area.dragover{border-color:var(--primary);background:rgba(34,211,238,0.05)}
    .hidden{display:none}
    canvas{max-width:100%;border-radius:8px;background:white;display:block;margin:0 auto}
    .page-list{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .thumb{width:100px;height:140px;border:1px solid var(--border);border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center;cursor:pointer;background:var(--bg)}
    .rotation-btn{padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card);color:var(--text);cursor:pointer}
    .rotation-btn.active,.rotation-btn:hover{background:var(--primary);color:#00131f}
    .btn{padding:12px 20px;border-radius:var(--radius);border:none;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px}
    .btn-primary{background:var(--primary);color:#00131f}
    .btn-secondary{background:var(--card);color:var(--text);border:1px solid var(--border)}
    footer{margin-top:auto;padding:18px 0;background:var(--card);border-top:1px solid var(--border)}
    .footer-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .footer-links{display:flex;gap:14px;flex-wrap:wrap}
    .footer-links a{color:var(--primary);text-decoration:none;font-weight:600}
    @media(max-width:720px){.upload-area{padding:20px}.rotation-btn{padding:8px 10px}.btn{width:100%;justify-content:center}}
  </style>
</head>
<body>
<header class="container">
  <div class="brand">
    <a href="index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;">
      <img src="https://img.icons8.com/fluency/48/toolbox.png" alt="Smarttool Hub Logo">
      <div>
        <div class="title">Smarttool Hub</div>
        <div class="tag">Fast • Private • 100% Client-side</div>
      </div>
    </a>
  </div>
  <div class="header-actions">
    <a href="index.html" class="btn-header"><i class="fa-solid fa-house"></i> Home</a>
    <button class="btn-header" id="themeToggle" title="Toggle dark/light mode"><i class="fa-solid fa-moon"></i></button>
  </div>
</header>

<main class="container">
  <div class="tool-content">
    <h1 class="tool-title">Rotate PDF Pages</h1>
    <p class="tool-description">Rotate single or all PDF pages. Your files are processed entirely in your browser—no server uploads.</p>

    <div class="upload-area" id="uploadArea" title="Click or drop a PDF here">
      <i class="fas fa-file-pdf" style="font-size:3rem;color:var(--muted);"></i>
      <div style="margin-top:10px;font-weight:600">Drop your PDF here or click to browse</div>
      <div style="margin-top:6px;color:var(--muted);font-size:.95rem">Max size: 100MB — processed in your browser</div>
      <input id="fileInput" type="file" accept="application/pdf" class="hidden">
    </div>

    <div id="editor" class="hidden">
      <div style="margin-bottom:12px;display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div style="font-weight:700" id="fileInfo">document.pdf</div>
        <div style="color:var(--muted)" id="fileMeta"></div>
      </div>

      <canvas id="pageCanvas"></canvas>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <button id="prevPage" class="btn btn-secondary"><i class="fa-solid fa-chevron-left"></i> Prev</button>
        <div id="pageLabel" style="color:var(--muted)"></div>
        <button id="nextPage" class="btn btn-secondary">Next <i class="fa-solid fa-chevron-right"></i></button>
      </div>

      <div style="margin-top:15px;display:flex;gap:10px;flex-wrap:wrap">
        <button class="rotation-btn" data-deg="90">Rotate +90°</button>
        <button class="rotation-btn" data-deg="-90">Rotate -90°</button>
        <button class="rotation-btn" data-deg="180">Rotate 180°</button>
      </div>

      <div style="margin-top:15px;display:flex;align-items:center;gap:10px;flex-wrap:wrap">
        <label for="applyScope">Apply to:</label>
        <select id="applyScope">
          <option value="current">Current Page</option>
          <option value="all">All Pages</option>
          <option value="range">Page Range</option>
        </select>
        <span id="rangeInputs" style="display:none">
          <input id="rangeFrom" type="number" min="1" style="width:72px;padding:6px;border-radius:8px;background:var(--bg);border:1px solid var(--border);color:var(--text)">
          to
          <input id="rangeTo" type="number" min="1" style="width:72px;padding:6px;border-radius:8px;background:var(--bg);border:1px solid var(--border);color:var(--text)">
        </span>
      </div>

      <div class="page-list" id="pageList"></div>

      <div style="margin-top:15px;display:flex;gap:12px;flex-wrap:wrap">
        <button id="applyBtn" class="btn btn-primary"><i class="fa-solid fa-check-circle"></i> Apply Rotation</button>
        <button id="downloadBtn" class="btn btn-secondary" disabled><i class="fa-solid fa-download"></i> Download Rotated PDF</button>
        <button id="resetBtn" class="btn btn-secondary"><i class="fa-solid fa-redo"></i> Reset</button>
      </div>
      <div id="status" style="margin-top:10px;color:var(--muted)"></div>
    </div>
  </div>
</main>

<footer class="container">
  <div class="footer-inner">
    <div>© <span id="year"></span> Smarttool Hub</div>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="contact.html">Contact</a>
      <a href="faq.html">FAQ</a>
    </div>
  </div>
</footer>

<!-- Libraries -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>

<script>
  // UI init
  document.getElementById('year').textContent = new Date().getFullYear();
  const themeToggle=document.getElementById('themeToggle');
  if(localStorage.getItem('sth_theme')==='light'){document.body.classList.add('light');themeToggle.innerHTML='<i class="fa-solid fa-sun"></i>';}
  themeToggle.onclick=()=>{document.body.classList.toggle('light');if(document.body.classList.contains('light')){themeToggle.innerHTML='<i class="fa-solid fa-sun"></i>';localStorage.setItem('sth_theme','light');}else{themeToggle.innerHTML='<i class="fa-solid fa-moon"></i>';localStorage.removeItem('sth_theme');}};

  // PDF.js worker
  if(window.pdfjsLib){pdfjsLib.GlobalWorkerOptions.workerSrc='https://mozilla.github.io/pdf.js/build/pdf.worker.js';}

  // Elements
  const uploadArea=document.getElementById('uploadArea');
  const fileInput=document.getElementById('fileInput');
  const editor=document.getElementById('editor');
  const fileInfo=document.getElementById('fileInfo');
  const fileMeta=document.getElementById('fileMeta');
  const pageCanvas=document.getElementById('pageCanvas');
  const ctx=pageCanvas.getContext('2d');
  const prevPage=document.getElementById('prevPage');
  const nextPage=document.getElementById('nextPage');
  const pageLabel=document.getElementById('pageLabel');
  const pageList=document.getElementById('pageList');
  const applyScope=document.getElementById('applyScope');
  const rangeInputs=document.getElementById('rangeInputs');
  const rangeFrom=document.getElementById('rangeFrom');
  const rangeTo=document.getElementById('rangeTo');
  const rotationBtns=document.querySelectorAll('.rotation-btn');
  const applyBtn=document.getElementById('applyBtn');
  const downloadBtn=document.getElementById('downloadBtn');
  const resetBtn=document.getElementById('resetBtn');
  const status=document.getElementById('status');

  // State
  let arrayBuffer=null, pdfDocJS=null, totalPages=0, currentPage=1, pageRotations={}, selectedRotation=0;
  let originalCanvasWidth = 0, originalCanvasHeight = 0;

  // Helpers
  function setStatus(msg,isError){ status.textContent=msg; status.style.color=isError? '#ef4444' : 'var(--muted)'; }
  function clearStatus(){ status.textContent=''; }

  // Drag & drop visuals
  uploadArea.addEventListener('dragover', e=>{ e.preventDefault(); uploadArea.classList.add('dragover'); });
  uploadArea.addEventListener('dragleave', e=>{ e.preventDefault(); uploadArea.classList.remove('dragover'); });
  uploadArea.addEventListener('drop', e=>{ e.preventDefault(); uploadArea.classList.remove('dragover'); const f = e.dataTransfer.files && e.dataTransfer.files[0]; if(f) handleFile(f); });

  // Click to open file picker
  uploadArea.addEventListener('click', ()=>fileInput.click());
  fileInput.addEventListener('change', e=>{ const f=e.target.files && e.target.files[0]; if(f) handleFile(f); });

  // Reset / remove
  resetBtn.addEventListener('click', ()=>{ fileInput.value=''; editor.classList.add('hidden'); ctx.clearRect(0,0,pageCanvas.width,pageCanvas.height); arrayBuffer=null; pdfDocJS=null; totalPages=0; currentPage=1; pageRotations={}; downloadBtn.disabled=true; fileInfo.textContent='document.pdf'; fileMeta.textContent=''; clearStatus(); pageList.innerHTML=''; });

  // Handle file
  async function handleFile(file){
    try {
      if(file.type !== 'application/pdf'){ setStatus('Please select a PDF file', true); return; }
      if(file.size > 100 * 1024 * 1024){ setStatus('File too large (max 100MB)', true); return; }

      setStatus('Loading PDF...');
      arrayBuffer = await file.arrayBuffer();
      pdfDocJS = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
      totalPages = pdfDocJS.numPages;
      // init rotations
      pageRotations = {};
      for(let i=1;i<=totalPages;i++) pageRotations[i]=0;

      editor.classList.remove('hidden');
      fileInfo.textContent = file.name;
      fileMeta.textContent = `${(file.size/1024/1024).toFixed(2)} MB • ${totalPages} page(s)`;
      downloadBtn.disabled = false;
      selectedRotation = 0;
      clearStatus();
      buildThumbnails();
      await renderPage(1);
    } catch (err) {
      console.error(err);
      setStatus('Error loading PDF', true);
    }
  }

  // Thumbnails
  async function buildThumbnails(){
    pageList.innerHTML = '';
    for(let p=1;p<=totalPages;p++){
      const div = document.createElement('div'); div.className='thumb';
      const cv = document.createElement('canvas'); cv.width = 100; cv.height = 140; div.appendChild(cv);
      pageList.appendChild(div);
      // render low-res
      (async function(pageNum, canvasEl){
        try{
          const page = await pdfDocJS.getPage(pageNum);
          const viewport = page.getViewport({scale: 0.2});
          await page.render({canvasContext: canvasEl.getContext('2d'), viewport}).promise;
        }catch(e){ console.warn('thumb render err', e) }
      })(p, cv);
      div.addEventListener('click', ()=>renderPage(p));
    }
  }

  // Render page with preview rotation applied visually on canvas
  async function renderPage(n){
    if(!pdfDocJS) return;
    currentPage = n;
    const page = await pdfDocJS.getPage(n);
    // choose scale reasonably for display
    const scale = Math.min(1.5, (800 / page.getViewport({scale:1}).height));
    const viewport = page.getViewport({scale});
    // render into canvas sized to viewport
    pageCanvas.width = Math.round(viewport.width);
    pageCanvas.height = Math.round(viewport.height);
    originalCanvasWidth = pageCanvas.width;
    originalCanvasHeight = pageCanvas.height;

    // draw page
    await page.render({canvasContext: ctx, viewport}).promise;

    // apply preview rotation from pageRotations
    const deg = (pageRotations[n] || 0) % 360;
    if(deg !== 0){
      // draw rotated result onto a temp canvas with correct swapped dims
      const radians = deg * Math.PI / 180;
      // calculate new dims
      const absCos = Math.abs(Math.cos(radians));
      const absSin = Math.abs(Math.sin(radians));
      const newW = Math.round(originalCanvasWidth * absCos + originalCanvasHeight * absSin);
      const newH = Math.round(originalCanvasWidth * absSin + originalCanvasHeight * absCos);

      const temp = document.createElement('canvas');
      temp.width = newW;
      temp.height = newH;
      const tctx = temp.getContext('2d');

      // move origin to center then rotate then draw
      tctx.translate(newW/2, newH/2);
      tctx.rotate(radians);
      tctx.drawImage(pageCanvas, -originalCanvasWidth/2, -originalCanvasHeight/2);

      // resize visible canvas to new dims and draw temp
      pageCanvas.width = newW;
      pageCanvas.height = newH;
      ctx.clearRect(0,0,newW,newH);
      ctx.drawImage(temp, 0, 0);
    }

    pageLabel.textContent = `Page ${currentPage} of ${totalPages}`;
    prevPage.disabled = currentPage === 1;
    nextPage.disabled = currentPage === totalPages;
    clearStatus();
  }

  // prev/next
  prevPage.addEventListener('click', ()=>{ if(currentPage>1) renderPage(currentPage-1); });
  nextPage.addEventListener('click', ()=>{ if(currentPage<totalPages) renderPage(currentPage+1); });

  // apply scope UI
  applyScope.addEventListener('change', ()=>{ rangeInputs.style.display = applyScope.value === 'range' ? 'inline-flex' : 'none'; });

  // rotation btns
  rotationBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      rotationBtns.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      selectedRotation = parseInt(btn.getAttribute('data-deg')) || 0;
    });
  });

  // Apply rotation to selected pages (update pageRotations and preview)
  applyBtn.addEventListener('click', async ()=>{
    if(!selectedRotation){ setStatus('Select rotation first', true); return; }
    let pages = [];
    if(applyScope.value === 'current') pages = [currentPage];
    else if(applyScope.value === 'all') pages = Array.from({length: totalPages}, (_,i) => i+1);
    else if(applyScope.value === 'range'){
      const from = parseInt(rangeFrom.value) || 1;
      const to = parseInt(rangeTo.value) || totalPages;
      if(from < 1 || to > totalPages || from > to){ setStatus('Invalid page range', true); return; }
      pages = Array.from({length: to-from+1}, (_,i) => from + i);
    }
    pages.forEach(p => { pageRotations[p] = (pageRotations[p] + selectedRotation) % 360; });
    setStatus(`Rotation applied to ${pages.length} page(s)`);
    // clear selection
    rotationBtns.forEach(b=>b.classList.remove('active'));
    selectedRotation = 0;
    await renderPage(currentPage);
    // refresh thumbnails (optional) - thumbnails remain original; preview shows rotation
  });

  // Download using pdf-lib — modify a fresh copy each time
  downloadBtn.addEventListener('click', async ()=>{
    if(!arrayBuffer){ setStatus('No PDF loaded', true); return; }
    setStatus('Preparing rotated PDF...');
    try {
      const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
      const pageCount = pdfDoc.getPageCount();
      for(let i=0;i<pageCount;i++){
        const deg = pageRotations[i+1] || 0;
        if(deg !== 0){
          const page = pdfDoc.getPage(i);
          // pdf-lib rotation uses degrees helper
          page.setRotation(PDFLib.degrees(deg + (page.getRotation?.()?.angle || 0)));
        }
      }
      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'rotated-' + (fileInfo.textContent || 'document.pdf'); document.body.appendChild(a); a.click();
      setTimeout(()=>{ document.body.removeChild(a); URL.revokeObjectURL(url); }, 300);
      setStatus('Rotated PDF ready');
    } catch (err) {
      console.error(err);
      setStatus('Error creating rotated PDF', true);
    }
  });

  // Accessibility: keyboard support for upload (Enter to open file picker)
  uploadArea.addEventListener('keydown', e => { if(e.key === 'Enter') fileInput.click(); });

</script>
</body>
</html>
