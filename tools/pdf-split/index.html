<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Split PDF Pages — Smarttool Hub</title>
  <meta name="description" content="Split PDF pages online. Upload a PDF, preview thumbnails, choose page ranges or select pages, and download selected pages as a new PDF or separate PDFs in a ZIP. 100% client-side." />
  <meta name="keywords" content="split pdf, pdf split, extract pages from pdf, split pdf online, pdf page extractor"/>
  <link rel="icon" href="https://img.icons8.com/fluency/48/toolbox.png"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <style>
    :root{--bg:#0b1220;--text:#eaf2ff;--card:#182335;--border:#2a3b55;--primary:#22d3ee;--muted:#9fb3c8}
    body.light{--bg:#f6f8fb;--text:#0b1220;--card:#fff;--border:#e6eefc;--primary:#0b74ff;--muted:#556677}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text);transition:.22s}
    .container{max-width:1100px;margin:0 auto;padding:18px}
    header{display:flex;justify-content:space-between;align-items:center;background:var(--card);padding:12px;border-bottom:1px solid var(--border)}
    .brand a{display:flex;gap:12px;align-items:center;text-decoration:none;color:inherit}
    .brand img{width:46px;height:46px;border-radius:8px}
    .title{font-weight:700;color:var(--primary)}
    .tag{font-size:.85rem;color:var(--muted)}
    .header-actions{display:flex;gap:8px;align-items:center}
    .btn-header{border:1px solid var(--border);background:transparent;padding:8px 12px;border-radius:8px;color:var(--text);cursor:pointer;display:flex;gap:8px;align-items:center;text-decoration:none;font-weight:600}
    main{padding:18px 0}
    h1{margin:6px 0 8px;color:var(--primary)}
    .meta{color:var(--muted);margin-bottom:12px}
    .uploader{min-height:110px;border-radius:12px;border:2px dashed var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px;background:var(--card);cursor:pointer}
    .uploader:hover{border-color:var(--primary)}
    input[type=file]{display:none}
    .controls{display:flex;gap:12px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .controls input[type=text]{padding:8px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text)}
    .progress{height:12px;background:var(--border);border-radius:999px;overflow:hidden;margin-top:12px}
    .progress-bar{height:100%;width:0;background:var(--primary);transition:width .2s}
    .pages{margin-top:18px;display:flex;flex-wrap:wrap;gap:12px;max-height:420px;overflow:auto;padding:8px}
    .page-card{width:110px;background:var(--card);border:1px solid var(--border);border-radius:8px;padding:8px;display:flex;flex-direction:column;align-items:center;gap:8px}
    .page-card canvas{width:96px;height:auto;background:#fff;border-radius:6px}
    .page-label{font-size:.85rem;color:var(--muted);text-align:center}
    .actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
    .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--primary);color:#00131f}
    .btn-ghost{background:transparent;border:1px solid var(--border);color:var(--text)}
    .status{color:var(--muted);display:flex;align-items:center;gap:8px}
    .spinner{width:18px;height:18px;border-radius:50%;border:3px solid rgba(255,255,255,0.08);border-top-color:var(--primary);animation:spin .9s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    footer{margin-top:24px;padding:12px 0;background:var(--card);border-top:1px solid var(--border)}
    @media(max-width:820px){.controls{flex-direction:column;align-items:flex-start}.page-card{width:30%}}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="container">
    <div class="brand">
      <a href="../../index.html" title="Smarttool Hub home">
        <img src="https://img.icons8.com/fluency/48/toolbox.png" alt="Smarttool Hub logo">
        <div>
          <div class="title">Smarttool Hub</div>
          <div class="tag">Fast • Private • Client-side</div>
        </div>
      </a>
    </div>
    <div class="header-actions">
      <a href="../../index.html" class="btn-header"><i class="fa-solid fa-house"></i> Home</a>
      <button id="themeToggle" class="btn-header" title="Toggle theme"><i class="fa-solid fa-moon"></i></button>
    </div>
  </header>

  <main class="container">
    <h1>Split PDF Pages</h1>
    <p class="meta">Upload a PDF, preview its pages (thumbnails), select pages or enter ranges (e.g. <code>1-3,5</code>), then extract those pages into a new PDF or download each page as separate PDFs inside a ZIP. No files leave your device.</p>

    <label class="uploader" id="uploader">
      <div style="font-size:28px;color:var(--primary)"><i class="fa-solid fa-file-pdf"></i></div>
      <div style="margin-top:8px;font-weight:700">Click or drag & drop a PDF</div>
      <div style="margin-top:6px;color:var(--muted)">Supported: .pdf — single file at a time for preview & split.</div>
      <input type="file" id="fileInput" accept="application/pdf" />
    </label>

    <div class="controls" role="region" aria-label="split controls">
      <input type="text" id="rangeField" placeholder="Type ranges e.g. 1-3,5 (optional)">
      <button id="applyRangeBtn" class="btn btn-ghost">Apply Range</button>
      <button id="selectAllBtn" class="btn btn-ghost">Select all</button>
      <button id="deselectAllBtn" class="btn btn-ghost">Deselect all</button>
      <div style="margin-left:auto;color:var(--muted)">Selected: <span id="selectedCount">0</span></div>
    </div>

    <div class="progress" aria-hidden="true"><div class="progress-bar" id="progressBar"></div></div>

    <div class="pages" id="pages" aria-live="polite"></div>

    <div class="actions">
      <button id="extractSelectedBtn" class="btn btn-primary" disabled><i class="fa-solid fa-file-arrow-down"></i> Extract selected pages → single PDF</button>
      <button id="extractZipBtn" class="btn btn-ghost" disabled><i class="fa-solid fa-file-zipper"></i> Extract selected pages → separate PDFs (ZIP)</button>
      <button id="clearBtn" class="btn btn-ghost" disabled><i class="fa-solid fa-trash-can"></i> Clear</button>
      <div class="status" id="status"></div>
    </div>
  </main>

  <footer class="container">
    <div>© <span id="year"></span> Smarttool Hub</div>
    <div style="color:var(--muted)">Privacy • Terms • Contact</div>
  </footer>

  <!-- FAQ JSON-LD -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[{"@type":"Question","name":"How do I split pages from a PDF?","acceptedAnswer":{"@type":"Answer","text":"Upload a PDF, choose pages or ranges and click Extract. The selected pages will be downloaded as a new PDF or as separate PDFs inside a ZIP."}},{"@type":"Question","name":"Are my files uploaded?","acceptedAnswer":{"@type":"Answer","text":"No — all processing is done in your browser; files are not uploaded to our servers."}}]}
  </script>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';</script>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <script>
  (function(){
    // ---------- theme + year ----------
    const themeBtn = document.getElementById('themeToggle');
    if(localStorage.getItem('sth_theme') === 'light'){ document.body.classList.add('light'); themeBtn.innerHTML = '<i class="fa-solid fa-sun"></i>'; }
    themeBtn.addEventListener('click', ()=> {
      document.body.classList.toggle('light');
      if(document.body.classList.contains('light')){ themeBtn.innerHTML = '<i class="fa-solid fa-sun"></i>'; localStorage.setItem('sth_theme','light'); }
      else { themeBtn.innerHTML = '<i class="fa-solid fa-moon"></i>'; localStorage.removeItem('sth_theme'); }
    });
    document.getElementById('year').textContent = new Date().getFullYear();

    // ---------- DOM refs ----------
    const uploader = document.getElementById('uploader');
    const fileInput = document.getElementById('fileInput');
    const pagesDiv = document.getElementById('pages');
    const progressBar = document.getElementById('progressBar');
    const statusEl = document.getElementById('status');

    const rangeField = document.getElementById('rangeField');
    const applyRangeBtn = document.getElementById('applyRangeBtn');
    const selectAllBtn = document.getElementById('selectAllBtn');
    const deselectAllBtn = document.getElementById('deselectAllBtn');
    const selectedCountEl = document.getElementById('selectedCount');

    const extractSelectedBtn = document.getElementById('extractSelectedBtn');
    const extractZipBtn = document.getElementById('extractZipBtn');
    const clearBtn = document.getElementById('clearBtn');

    // ---------- state ----------
    // pdfData: { arrayBuffer, pdfjsDoc, pageCount, selectedPages:Set, fileName }
    let pdfData = null;

    // ---------- helpers ----------
    function showStatus(txt, busy=false, hideMs=0){
      statusEl.textContent = txt || '';
      if(busy) statusEl.insertAdjacentHTML('afterbegin','<span class="spinner" aria-hidden="true"></span>');
      if(hideMs) setTimeout(()=> statusEl.textContent = '', hideMs);
    }
    function setProgress(p){ progressBar.style.width = Math.min(100,Math.max(0,Math.round(p))) + '%'; }
    function resetProgress(){ progressBar.style.width = '0%'; }
    function sanitize(name){ return name.replace(/[^a-z0-9_\-\.]/gi, '_'); }
    function triggerDownload(blob, filename){
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=> URL.revokeObjectURL(a.href), 3000);
    }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    // ---------- file input + DnD ----------
    uploader.addEventListener('click', ()=> fileInput.click());
    uploader.addEventListener('dragover', e => { e.preventDefault(); uploader.style.borderColor = 'var(--primary)'; });
    uploader.addEventListener('dragleave', e => { uploader.style.borderColor = ''; });
    uploader.addEventListener('drop', e => { e.preventDefault(); uploader.style.borderColor = ''; handleFile(e.dataTransfer.files[0]); });
    fileInput.addEventListener('change', e => handleFile(e.target.files[0]));

    async function handleFile(file){
      if(!file) return;
      if(!(file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf'))){
        alert('Please select a PDF file.');
        return;
      }
      showStatus('Reading PDF...', true);
      resetProgress();
      try{
        const buffer = await file.arrayBuffer();
        // load pdf.js doc for thumbnails and page count
        const pdfjsDoc = await pdfjsLib.getDocument({ data: buffer }).promise;
        const pageCount = pdfjsDoc.numPages;
        pdfData = { arrayBuffer: buffer, pdfjsDoc, pageCount, selectedPages: new Set(), fileName: file.name };
        // initially select all pages
        for(let i=0;i<pageCount;i++) pdfData.selectedPages.add(i);
        renderPagesThumbnails();
        updateButtons();
        showStatus('PDF loaded: ' + pageCount + ' pages', false, 2000);
      } catch(err){
        console.error('Failed to load PDF', err);
        showStatus('Failed to load PDF — see console', false);
      }
    }

    // ---------- render thumbnails (lazy small-scale render) ----------
    async function renderPagesThumbnails(){
      pagesDiv.innerHTML = '';
      if(!pdfData) return;
      const max = pdfData.pageCount;
      // render each page thumbnail sequentially
      for(let p=1;p<=max;p++){
        const page = await pdfData.pdfjsDoc.getPage(p);
        const viewport = page.getViewport({ scale: 0.18 }); // small thumb
        const canvas = document.createElement('canvas');
        canvas.width = Math.round(viewport.width);
        canvas.height = Math.round(viewport.height);
        const ctx = canvas.getContext('2d');
        await page.render({ canvasContext: ctx, viewport }).promise;

        const card = document.createElement('div');
        card.className = 'page-card';
        card.innerHTML = `
          <label style="display:flex;flex-direction:column;align-items:center;gap:6px">
            <input type="checkbox" class="page-checkbox" data-page="${p-1}">
            <div style="width:96px;height:120px;display:flex;align-items:center;justify-content:center;"></div>
            <div class="page-label">Page ${p}</div>
          </label>
        `;
        card.querySelector('div').appendChild(canvas);

        const cb = card.querySelector('.page-checkbox');
        // default checked (we added to selectedPages earlier)
        cb.checked = pdfData.selectedPages.has(p-1);
        cb.addEventListener('change', (e) => {
          if(e.target.checked) pdfData.selectedPages.add(p-1); else pdfData.selectedPages.delete(p-1);
          updateSelectedCount();
        });

        pagesDiv.appendChild(card);
        // small yield to allow UI update for many pages
        await new Promise(r => setTimeout(r, 12));
      }
      updateSelectedCount();
    }

    // ---------- selection helpers ----------
    function updateSelectedCount(){
      if(!pdfData) { selectedCountEl.textContent = '0'; return; }
      selectedCountEl.textContent = pdfData.selectedPages.size;
      extractSelectedBtn.disabled = pdfData.selectedPages.size === 0;
      extractZipBtn.disabled = pdfData.selectedPages.size === 0;
      clearBtn.disabled = false;
    }

    selectAllBtn.addEventListener('click', () => {
      if(!pdfData) return;
      pdfData.selectedPages = new Set(Array.from({length: pdfData.pageCount}, (_,i)=>i));
      pagesDiv.querySelectorAll('.page-checkbox').forEach(cb => cb.checked = true);
      updateSelectedCount();
    });
    deselectAllBtn.addEventListener('click', () => {
      if(!pdfData) return;
      pdfData.selectedPages.clear();
      pagesDiv.querySelectorAll('.page-checkbox').forEach(cb => cb.checked = false);
      updateSelectedCount();
    });

    applyRangeBtn.addEventListener('click', () => {
      if(!pdfData) return;
      const txt = rangeField.value.trim();
      if(!txt) return;
      const sel = parseRange(txt, pdfData.pageCount);
      pdfData.selectedPages = new Set(sel);
      // update checkboxes
      pagesDiv.querySelectorAll('.page-checkbox').forEach(cb => {
        const p = Number(cb.dataset.page);
        cb.checked = pdfData.selectedPages.has(p);
      });
      updateSelectedCount();
    });

    // parse range e.g. "1-3,5" -> zero-based indices
    function parseRange(str, pageCount){
      const tokens = str.split(',').map(s => s.trim()).filter(Boolean);
      const out = new Set();
      tokens.forEach(tok => {
        if(tok.includes('-')){
          const [a,b] = tok.split('-').map(n => parseInt(n.trim(),10));
          if(isNaN(a) || isNaN(b)) return;
          const start = Math.max(1, Math.min(a,b));
          const end = Math.min(pageCount, Math.max(a,b));
          for(let i=start;i<=end;i++) out.add(i-1);
        } else {
          const n = parseInt(tok,10);
          if(!isNaN(n) && n>=1 && n<=pageCount) out.add(n-1);
        }
      });
      return Array.from(out).sort((a,b)=>a-b);
    }

    // ---------- extract selected pages into single PDF ----------
    extractSelectedBtn.addEventListener('click', async () => {
      if(!pdfData || pdfData.selectedPages.size === 0) { alert('No pages selected'); return; }
      showStatus('Extracting pages...', true);
      setProgress(0);
      try{
        const selected = Array.from(pdfData.selectedPages).sort((a,b)=>a-b);
        const src = await PDFLib.PDFDocument.load(pdfData.arrayBuffer, { ignoreEncryption: true });
        const outDoc = await PDFLib.PDFDocument.create();
        // copy in chunks to prevent memory spikes
        // pdf-lib supports copyPages with pages indices array
        const copied = await outDoc.copyPages(src, selected);
        for(const page of copied) outDoc.addPage(page);
        setProgress(80);
        const bytes = await outDoc.save();
        setProgress(100);
        triggerDownload(new Blob([bytes], { type: 'application/pdf' }), sanitize(pdfData.fileName).replace(/\.[^/.]+$/, '') + '_extracted.pdf');
        showStatus('Extraction complete ✓', false, 2000);
      } catch(err){
        console.error('Extraction failed', err);
        showStatus('Extraction failed — see console', false);
      } finally {
        setTimeout(()=> resetProgress(), 700);
      }
    });

    // ---------- extract selected pages as separate PDFs in a ZIP ----------
    extractZipBtn.addEventListener('click', async () => {
      if(!pdfData || pdfData.selectedPages.size === 0) { alert('No pages selected'); return; }
      showStatus('Creating separate PDFs & ZIP...', true);
      setProgress(0);
      try{
        const selected = Array.from(pdfData.selectedPages).sort((a,b)=>a-b);
        const src = await PDFLib.PDFDocument.load(pdfData.arrayBuffer, { ignoreEncryption: true });
        const zip = new JSZip();
        let processed = 0;
        for(const idx of selected){
          const outDoc = await PDFLib.PDFDocument.create();
          const [copied] = await outDoc.copyPages(src, [idx]);
          outDoc.addPage(copied);
          const bytes = await outDoc.save();
          const filename = sanitize(pdfData.fileName).replace(/\.[^/.]+$/, '') + '_page_' + (idx+1) + '.pdf';
          zip.file(filename, bytes);
          processed++;
          setProgress((processed/selected.length)*100);
          await new Promise(r=>setTimeout(r, 20));
        }
        const blob = await zip.generateAsync({ type: 'blob' });
        triggerDownload(blob, sanitize(pdfData.fileName).replace(/\.[^/.]+$/, '') + '_pages.zip');
        showStatus('ZIP ready ✓', false, 2000);
      } catch(err){
        console.error('ZIP creation failed', err);
        showStatus('ZIP creation failed — see console', false);
      } finally { setTimeout(()=> resetProgress(), 700); }
    });

    // ---------- clear ----------
    clearBtn.addEventListener('click', () => {
      if(pdfData && pdfData.pdfjsDoc) try{ pdfData.pdfjsDoc.destroy(); }catch(e){}
      pdfData = null;
      pagesDiv.innerHTML = '';
      rangeField.value = '';
      selectedCountEl.textContent = '0';
      extractSelectedBtn.disabled = true;
      extractZipBtn.disabled = true;
      clearBtn.disabled = true;
      resetProgress();
      showStatus('', false);
    });

    // ---------- update buttons helper ----------
    function updateButtons(){
      const has = !!pdfData;
      extractSelectedBtn.disabled = !(has && pdfData.selectedPages.size>0);
      extractZipBtn.disabled = !(has && pdfData.selectedPages.size>0);
      clearBtn.disabled = !has;
    }

    // ---------- initial ----------
    updateButtons();

    // expose for debugging
    window._sth_pdfData = () => pdfData;

  })();
  </script>
</body>
</html>
