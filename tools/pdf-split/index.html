<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Split PDF Pages - Smarttool Hub</title>
  <meta name="description" content="Split PDF pages into separate files in your browser. Drag & drop, split, download single pages or a ZIP of everything." />
  <link rel="icon" href="https://img.icons8.com/fluency/48/toolbox.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <style>
    /* Kept the exact design language used in your uploaded tools */
    :root{
      --bg:#0b1220;--text:#eaf2ff;--card:#182335;--border:#2a3b55;
      --primary:#22d3ee;--muted:#9fb3c8;--radius:12px;
    }
    body.light{
      --bg:#f6f8fb;--text:#0b1220;--card:#ffffff;--border:#e6eefc;
      --primary:#0b74ff;--muted:#556677;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg);color:var(--text);transition:background .25s,color .25s;
      min-height:100vh;display:flex;flex-direction:column;
    }
    .container{max-width:1200px;margin:0 auto;padding:20px;width:100%}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      background:var(--card);border-bottom:1px solid var(--border);padding:14px 20px;
    }
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:46px;height:46px;border-radius:10px}
    .brand .title{font-size:1.25rem;font-weight:700;color:var(--primary);margin:0}
    .brand .tag{font-size:.9rem;color:var(--muted)}
    .header-actions{display:flex;gap:10px;align-items:center}
    .btn-header{
      border:1px solid var(--border);background:transparent;padding:8px 12px;border-radius:8px;
      color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;text-decoration:none;font-weight:600
    }
    .btn-header:hover{border-color:var(--primary);color:var(--primary)}

    .tool-content {
      background:var(--card);border-radius:var(--radius);border:1px solid var(--border);
      padding:25px;margin-top:20px;
    }
    .tool-title { font-size:1.8rem;margin-bottom:5px;color:var(--primary); }
    .tool-description { color:var(--muted);margin-bottom:18px; }

    .upload-area {
      border:2px dashed var(--border);border-radius:var(--radius);padding:30px;
      text-align:center;margin-bottom:20px;transition:all 0.3s;cursor:pointer;
      background:var(--bg);
    }
    .upload-area:hover, .upload-area.dragover { border-color:var(--primary);background:rgba(34,211,238,0.03); }
    .upload-icon { font-size:3rem;color:var(--muted);margin-bottom:12px; }
    .upload-text { color:var(--text);margin-bottom:10px;font-weight:600; }
    .upload-subtext { color:var(--muted);font-size:0.9rem; }
    .file-input { display:none; }

    .selected-list {
      display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-bottom:18px;
    }
    .file-card {
      background:var(--bg);border:1px solid var(--border);padding:12px;border-radius:10px;display:flex;gap:12px;align-items:flex-start;
    }
    .pdf-icon { width:86px;height:86px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#0f1720;border:1px solid var(--border);font-size:2rem;color:var(--primary) }
    .file-meta {flex:1}
    .file-meta h5{margin:0 0 6px 0;font-size:0.95rem;color:var(--text)}
    .file-meta p{margin:0;color:var(--muted);font-size:0.88rem}
    .file-actions {display:flex;flex-direction:column;gap:8px}
    .small-btn {padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
    .small-btn.primary {background:var(--primary);color:#00131f}
    .small-btn.secondary {background:var(--card);border:1px solid var(--border);color:var(--text)}
    .page-list { margin-top:10px; display:flex;flex-direction:column; gap:8px; max-height:200px; overflow:auto; }

    .action-buttons { display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px;align-items:center; }
    .btn { padding:12px 20px;border-radius:var(--radius);border:none;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px; }
    .btn-primary { background:var(--primary);color:#00131f; }
    .btn-secondary { background:var(--card);color:var(--text);border:1px solid var(--border); }
    .btn:disabled { opacity:0.6;cursor:not-allowed; }

    .status-message {
      margin-top:15px;padding:10px;border-radius:var(--radius);
      background:var(--bg);border:1px solid var(--border);
      color:var(--muted);font-size:0.9rem;display:none;
    }
    .status-success { border-color:#10b981;color:#10b981; }
    .status-error { border-color:#ef4444;color:#ef4444; }

    footer{margin-top:auto;padding:18px 0;background:var(--card);border-top:1px solid var(--border)}
    .footer-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .footer-links{display:flex;gap:14px;flex-wrap:wrap}
    .footer-links a{color:var(--primary);text-decoration:none;font-weight:600}

    @media (max-width:720px){
      header{flex-direction:column;align-items:flex-start;gap:10px}
      .header-actions{align-self:flex-end}
      .action-buttons{flex-direction:column}
      .btn{width:100%;justify-content:center}
    }
  </style>
</head>
<body>
<header class="container">
  <div class="brand">
    <a href="index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;">
      <img src="https://img.icons8.com/fluency/48/toolbox.png" alt="Smarttool Hub Logo">
      <div>
        <div class="title">Smarttool Hub</div>
        <div class="tag">Fast • Private • 100% Client-side</div>
      </div>
    </a>
  </div>
  <div class="header-actions">
    <a href="index.html" class="btn-header"><i class="fa-solid fa-house"></i> Home</a>
    <button class="btn-header" id="themeToggle" title="Toggle dark/light mode"><i class="fa-solid fa-moon"></i></button>
  </div>
</header>

<main class="container">
  <div class="tool-content">
    <h1 class="tool-title">Split PDF Pages</h1>
    <p class="tool-description">Split each page of your PDF into standalone PDF files. Add multiple PDFs, split them, then download each page individually or download everything as a ZIP. Everything runs in your browser.</p>

    <div class="upload-area" id="uploadArea" title="Click or drop PDF files here to add multiple files">
      <div class="upload-icon"><i class="fas fa-file-pdf"></i></div>
      <div class="upload-text">Drop PDF files here or click to browse</div>
      <div class="upload-subtext">Supports multiple PDF files. Each page will be exported as a separate PDF.</div>
      <input type="file" id="fileInput" class="file-input" accept="application/pdf" multiple>
    </div>

    <div id="selectedList" class="selected-list" aria-live="polite"></div>

    <div class="action-buttons">
      <button class="btn btn-primary" id="splitBtn" disabled><i class="fas fa-cut"></i> Split All</button>
      <button class="btn btn-secondary" id="downloadAllBtn" disabled><i class="fas fa-download"></i> Download All (ZIP)</button>
      <button class="btn btn-secondary" id="resetBtn"><i class="fas fa-redo"></i> Reset</button>
      <div style="margin-left:auto;color:var(--muted);font-weight:600" id="summaryText">No files selected</div>
    </div>

    <div id="statusMessage" class="status-message"></div>
  </div>
</main>

<footer class="container">
  <div class="footer-inner">
    <div>© <span id="year"></span> Smarttool Hub</div>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="contact.html">Contact</a>
    </div>
  </div>
</footer>

<!-- pdf-lib + JSZip -->
<script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
  // UI & theme
  document.getElementById('year').textContent = new Date().getFullYear();
  const themeToggle = document.getElementById('themeToggle');
  if (localStorage.getItem('sth_theme') === 'light') { document.body.classList.add('light'); themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>'; }
  themeToggle.onclick = () => {
    document.body.classList.toggle('light');
    if (document.body.classList.contains('light')) { themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>'; localStorage.setItem('sth_theme','light'); }
    else { themeToggle.innerHTML = '<i class="fa-solid fa-moon"></i>'; localStorage.removeItem('sth_theme'); }
  };

  // Elements
  const uploadArea = document.getElementById('uploadArea');
  const fileInput = document.getElementById('fileInput');
  const selectedList = document.getElementById('selectedList');
  const splitBtn = document.getElementById('splitBtn');
  const downloadAllBtn = document.getElementById('downloadAllBtn');
  const resetBtn = document.getElementById('resetBtn');
  const summaryText = document.getElementById('summaryText');
  const statusMessage = document.getElementById('statusMessage');

  // State
  // filesState: [{ id, file, arrayBuffer, pageCount, pagesGenerated: [{pageNumber, blob, filename}] }]
  let filesState = [];
  let allGenerated = false; // indicates if split step has produced outputs

  // Helpers
  function uid(){ return 'f_' + Math.random().toString(36).slice(2,9); }
  function isPdf(f){ return f && (f.type === 'application/pdf' || /\.pdf$/i.test(f.name)); }
  function showStatus(msg, type='success', autoHide=true){
    statusMessage.textContent = msg;
    statusMessage.classList.remove('status-success','status-error');
    statusMessage.style.display = 'block';
    if (type === 'success') statusMessage.classList.add('status-success');
    if (type === 'error') statusMessage.classList.add('status-error');
    if (autoHide) setTimeout(()=> statusMessage.style.display='none', 5000);
  }
  function formatFileSize(bytes){ if (!bytes) return '0 KB'; return (bytes/1024).toFixed(1) + ' KB'; }

  // Drag & drop + file input
  uploadArea.addEventListener('click', ()=> fileInput.click());
  uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
  uploadArea.addEventListener('dragleave', e => { e.preventDefault(); uploadArea.classList.remove('dragover'); });
  uploadArea.addEventListener('drop', e => {
    e.preventDefault(); uploadArea.classList.remove('dragover');
    handleFilesAdded(Array.from(e.dataTransfer.files || []));
  });
  fileInput.addEventListener('change', e => {
    handleFilesAdded(Array.from(e.target.files || []));
    fileInput.value = '';
  });

  async function handleFilesAdded(list) {
    const incoming = list.filter(isPdf);
    const rejected = list.filter(f => !isPdf(f));
    if (rejected.length) showStatus(`${rejected.length} non-PDF file(s) ignored`, 'error');
    if (!incoming.length) return;
    for (const file of incoming) {
      const id = uid();
      const entry = { id, file, arrayBuffer: null, pageCount: null, pagesGenerated: [] };
      filesState.push(entry);
      try {
        const ab = await file.arrayBuffer();
        entry.arrayBuffer = ab;
        // attempt to read page count
        try {
          const pdfDoc = await PDFLib.PDFDocument.load(ab, { ignoreEncryption: true });
          entry.pageCount = pdfDoc.getPageCount();
        } catch (err) {
          console.warn('Failed to read PDF page count', file.name, err);
          entry.pageCount = null;
        }
      } catch (err) {
        console.error('Failed to read file', file.name, err);
        showStatus(`Failed to read ${file.name}`, 'error');
      }
    }
    renderFileCards();
    updateControls();
    showStatus(`${incoming.length} file(s) added`, 'success');
  }

  // Render file cards
  function renderFileCards() {
    selectedList.innerHTML = '';
    filesState.forEach((entry, fileIndex) => {
      const file = entry.file;
      const card = document.createElement('div'); card.className = 'file-card'; card.id = 'card-'+entry.id;
      const icon = document.createElement('div'); icon.className = 'pdf-icon'; icon.innerHTML = '<i class="fa-solid fa-file-pdf"></i>';
      card.appendChild(icon);

      const meta = document.createElement('div'); meta.className = 'file-meta';
      const h5 = document.createElement('h5'); h5.textContent = file.name; meta.appendChild(h5);
      const p1 = document.createElement('p'); p1.textContent = `${formatFileSize(file.size)} • ${entry.pageCount ? entry.pageCount + ' page(s)' : 'Unknown pages'}`; meta.appendChild(p1);

      // per-file generated pages list
      const pageList = document.createElement('div'); pageList.className = 'page-list';
      if (entry.pagesGenerated && entry.pagesGenerated.length) {
        entry.pagesGenerated.forEach(pg => {
          const item = document.createElement('div');
          item.style.display = 'flex'; item.style.justifyContent = 'space-between'; item.style.alignItems = 'center'; item.style.gap = '8px';
          const left = document.createElement('div'); left.textContent = `Page ${pg.pageNumber}`;
          const right = document.createElement('div'); right.style.display = 'flex'; right.style.gap = '8px';
          const dlBtn = document.createElement('button'); dlBtn.className='small-btn primary'; dlBtn.textContent = 'Download'; dlBtn.onclick = () => {
            const url = URL.createObjectURL(pg.blob);
            const a = document.createElement('a'); a.href = url; a.download = pg.filename; document.body.appendChild(a); a.click();
            setTimeout(()=> { URL.revokeObjectURL(url); try{document.body.removeChild(a);}catch(e){} }, 300);
          };
          right.appendChild(dlBtn);
          item.appendChild(left); item.appendChild(right);
          pageList.appendChild(item);
        });
      }
      meta.appendChild(pageList);

      card.appendChild(meta);

      const actions = document.createElement('div'); actions.className = 'file-actions';
      const infoBtn = document.createElement('button'); infoBtn.className='small-btn secondary'; infoBtn.innerHTML = '<i class="fa-solid fa-info"></i>'; infoBtn.title='Show info'; infoBtn.onclick = ()=> {
        alert(`${file.name}\nSize: ${formatFileSize(file.size)}\nPages: ${entry.pageCount || 'Unknown'}`);
      };

      const removeBtn = document.createElement('button'); removeBtn.className='small-btn secondary'; removeBtn.innerHTML = '<i class="fa-solid fa-trash"></i>'; removeBtn.title='Remove'; removeBtn.onclick = ()=> {
        filesState = filesState.filter(f => f.id !== entry.id);
        renderFileCards();
        updateControls();
        showStatus('File removed', 'success');
      };

      actions.appendChild(infoBtn); actions.appendChild(removeBtn);
      card.appendChild(actions);

      selectedList.appendChild(card);
    });

    summaryText.textContent = filesState.length ? `${filesState.length} file(s) selected` : 'No files selected';
  }

  function updateControls() {
    splitBtn.disabled = filesState.length === 0;
    downloadAllBtn.disabled = !allGenerated;
  }

  // Split logic: for each file, create separate one-page PDFs and store blobs in entry.pagesGenerated
  async function splitAll() {
    if (!filesState.length) { showStatus('No files to split', 'error'); return; }
    if (typeof PDFLib === 'undefined') { showStatus('pdf-lib not loaded', 'error'); return; }

    // clear previous generated results
    filesState.forEach(f => f.pagesGenerated = []);
    allGenerated = false;
    renderFileCards();
    updateControls();

    showStatus('Splitting PDFs — please wait...', 'success', false);

    try {
      for (let i = 0; i < filesState.length; i++) {
        const entry = filesState[i];
        if (!entry.arrayBuffer) {
          showStatus(`Skipping unreadable file: ${entry.file.name}`, 'error');
          continue;
        }
        // load source doc
        const srcPdf = await PDFLib.PDFDocument.load(entry.arrayBuffer, { ignoreEncryption: true });
        const pageCount = srcPdf.getPageCount();
        entry.pageCount = pageCount;
        // for each page, create new PDF containing that page
        for (let p = 0; p < pageCount; p++) {
          const newPdf = await PDFLib.PDFDocument.create();
          const [copiedPage] = await newPdf.copyPages(srcPdf, [p]);
          newPdf.addPage(copiedPage);
          const bytes = await newPdf.save();
          const blob = new Blob([bytes], { type: 'application/pdf' });
          const filename = `${entry.file.name.replace(/\.pdf$/i,'')}_page-${p+1}.pdf`;
          entry.pagesGenerated.push({ pageNumber: p+1, blob, filename });
          // render incremental UI update
          renderFileCards();
        }
      }

      allGenerated = filesState.some(f => f.pagesGenerated && f.pagesGenerated.length > 0);
      showStatus('Split complete — download individual pages or use Download All (ZIP)', 'success');
      updateControls();
    } catch (err) {
      console.error('Split failed', err);
      showStatus('Failed to split PDFs', 'error');
    }
  }

  // Create ZIP of all generated page PDFs
  async function downloadAllAsZip() {
    const allPages = filesState.flatMap(f => f.pagesGenerated || []);
    if (!allPages.length) { showStatus('No generated pages to download', 'error'); return; }
    if (typeof JSZip === 'undefined') { showStatus('JSZip library not loaded', 'error'); return; }

    showStatus('Preparing ZIP...', 'success', false);

    try {
      const zip = new JSZip();
      allPages.forEach(pg => {
        zip.file(pg.filename, pg.blob);
      });
      const blob = await zip.generateAsync({ type: 'blob', compression: 'DEFLATE', compressionOptions: { level: 6 } }, (meta) => {
        // optional progress: meta.percent
      });

      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const ts = new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
      a.href = url; a.download = `split_pages_${ts}.zip`;
      document.body.appendChild(a); a.click();
      setTimeout(()=> { URL.revokeObjectURL(url); try{document.body.removeChild(a);}catch(e){} }, 500);
      showStatus('ZIP downloaded', 'success');
    } catch (err) {
      console.error('ZIP creation failed', err);
      showStatus('Failed to create ZIP', 'error');
    }
  }

  // Reset everything
  resetBtn.addEventListener('click', () => {
    filesState = [];
    allGenerated = false;
    selectedList.innerHTML = '';
    updateControls();
    showStatus('Reset complete', 'success');
  });

  splitBtn.addEventListener('click', async () => {
    splitBtn.disabled = true;
    await splitAll();
    splitBtn.disabled = false;
  });

  downloadAllBtn.addEventListener('click', downloadAllAsZip);

  // keyboard accessible: Enter/Space opens file dialog
  uploadArea.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); } });

  // initial update
  updateControls();

  // Optional: warn console user if pdf-lib/jszip missing
  if (typeof PDFLib === 'undefined') console.warn('pdf-lib not loaded - merging/splitting will not work until it loads.');
  if (typeof JSZip === 'undefined') console.warn('JSZip not loaded - ZIP download will not work until it loads.');
</script>
</body>
</html>
