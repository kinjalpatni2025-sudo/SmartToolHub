<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>PDF to Image Converter - Smarttool Hub</title>
  <meta name="description" content="Convert PDF files to high-quality images in PNG, JPG, or WebP format. 100% browser-based, private and fast."/>
  <link rel="icon" href="https://img.icons8.com/fluency/48/toolbox.png"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <style>
    :root{
      --bg:#0b1220;--text:#eaf2ff;--card:#182335;--border:#2a3b55;
      --primary:#22d3ee;--muted:#9fb3c8;--radius:12px;
    }
    body.light{
      --bg:#f6f8fb;--text:#0b1220;--card:#ffffff;--border:#e6eefc;
      --primary:#0b74ff;--muted:#556677;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg);color:var(--text);transition:background .25s,color .25s;
      min-height:100vh;display:flex;flex-direction:column;
    }
    .container{max-width:1200px;margin:0 auto;padding:20px;width:100%}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      background:var(--card);border-bottom:1px solid var(--border);padding:14px 20px;
    }
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:46px;height:46px;border-radius:10px}
    .brand .title{font-size:1.25rem;font-weight:700;color:var(--primary);margin:0}
    .brand .tag{font-size:.9rem;color:var(--muted)}
    .header-actions{display:flex;gap:10px;align-items:center}
    .btn-header{
      border:1px solid var(--border);background:transparent;padding:8px 12px;border-radius:8px;
      color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;text-decoration:none;font-weight:600
    }
    .btn-header:hover{border-color:var(--primary);color:var(--primary)}
    .tool-content {
      background:var(--card);border-radius:var(--radius);border:1px solid var(--border);
      padding:25px;margin-top:20px;
    }
    .tool-title {
      font-size:1.8rem;margin-bottom:5px;color:var(--primary);
    }
    .tool-description {
      color:var(--muted);margin-bottom:25px;
    }
    .upload-area {
      border:2px dashed var(--border);border-radius:var(--radius);padding:40px;
      text-align:center;margin-bottom:25px;transition:all 0.3s;cursor:pointer;
      background:var(--bg);
    }
    .upload-area:hover, .upload-area.dragover {
      border-color:var(--primary);background:rgba(34,211,238,0.05);
    }
    .upload-icon {
      font-size:3rem;color:var(--muted);margin-bottom:15px;
    }
    .upload-text {
      color:var(--text);margin-bottom:15px;font-weight:600;
    }
    .upload-subtext {
      color:var(--muted);font-size:0.9rem;
    }
    .file-input {display:none;}
    .selected-file {
      display:flex;align-items:center;gap:12px;padding:15px;
      background:var(--bg);border-radius:var(--radius);border:1px solid var(--border);
      margin-bottom:25px;
    }
    .file-icon {font-size:1.5rem;color:var(--primary);}
    .file-info {flex:1;}
    .file-name {font-weight:600;margin-bottom:4px;color:var(--text);}
    .file-size {color:var(--muted);font-size:0.9rem;}
    .remove-file {background:transparent;border:none;color:var(--muted);cursor:pointer;padding:5px;border-radius:4px;}
    .remove-file:hover {color:#ef4444;}
    .conversion-options {
      display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
      gap:20px;margin-bottom:25px;
    }
    .option-group {margin-bottom:15px;}
    .option-group label {display:block;margin-bottom:8px;font-weight:500;color:var(--text);}
    .option-group select, .option-group input[type="text"] {
      width:100%;padding:10px 12px;border-radius:var(--radius);
      background:var(--bg);border:1px solid var(--border);color:var(--text);
    }
    .page-range {display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    .quality-slider {display:flex;flex-direction:column;gap:8px;}
    input[type="range"] {
      width:100%;height:6px;border-radius:3px;background:var(--bg);
      outline:none;-webkit-appearance:none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--primary);cursor:pointer;
    }
    .preview-area {
      border:1px solid var(--border);border-radius:var(--radius);padding:20px;
      margin-bottom:25px;text-align:center;background:var(--bg);min-height:200px;
      display:flex;align-items:center;justify-content:center;
    }
    .preview-placeholder {color:var(--muted);}
    .preview-image {max-width:100%;max-height:300px;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
    .action-buttons {display:flex;gap:12px;flex-wrap:wrap;}
    .btn {padding:12px 20px;border-radius:var(--radius);border:none;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;}
    .btn-primary {background:var(--primary);color:#00131f;}
    .btn-secondary {background:var(--card);color:var(--text);border:1px solid var(--border);}
    .btn:disabled {opacity:0.6;cursor:not-allowed;}
    .status-message {margin-top:15px;padding:10px;border-radius:var(--radius);background:var(--bg);border:1px solid var(--border);color:var(--muted);font-size:0.9rem;display:none;}
    .status-success {border-color:#10b981;color:#10b981;}
    .status-error {border-color:#ef4444;color:#ef4444;}
    .results-container {margin-top:30px;border-top:1px solid var(--border);padding-top:20px;display:none;}
    .results-container h3 {margin-bottom:15px;color:var(--primary);}
    .results-grid {display:grid;grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));gap:15px;}
    .result-item {background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:15px;text-align:center;}
    .result-image {width:100%;height:150px;object-fit:contain;margin-bottom:10px;border-radius:4px;background:#f0f0f0;}
    .result-info {font-size:0.9rem;color:var(--muted);margin-bottom:10px;}
    .result-actions {display:flex;gap:8px;justify-content:center;}
    .result-btn {padding:6px 12px;border-radius:var(--radius);border:none;font-size:0.8rem;cursor:pointer;display:flex;align-items:center;gap:4px;background:var(--card);color:var(--text);border:1px solid var(--border);}
    .result-btn:hover {background:var(--primary);color:#00131f;border-color:var(--primary);}
    footer{margin-top:auto;padding:18px 0;background:var(--card);border-top:1px solid var(--border)}
    .footer-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .footer-links{display:flex;gap:14px;flex-wrap:wrap}
    .footer-links a{color:var(--primary);text-decoration:none;font-weight:600}
    @media (max-width:720px){
      header{flex-direction:column;align-items:flex-start;gap:10px}
      .header-actions{align-self:flex-end}
      .conversion-options{grid-template-columns:1fr;}
      .action-buttons{flex-direction:column;}
      .btn{width:100%;justify-content:center;}
      .results-grid{grid-template-columns:1fr 1fr;}
    }
    @media (max-width:480px){
      .results-grid{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
<header class="container">
  <div class="brand">
    <a href="index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;">
      <img src="https://img.icons8.com/fluency/48/toolbox.png" alt="Smarttool Hub Logo">
      <div>
        <div class="title">Smarttool Hub</div>
        <div class="tag">Fast • Private • 100% Client-side</div>
      </div>
    </a>
  </div>
  <div class="header-actions">
    <a href="index.html" class="btn-header"><i class="fa-solid fa-house"></i> Home</a>
    <button class="btn-header" id="themeToggle" title="Toggle dark/light mode"><i class="fa-solid fa-moon"></i></button>
  </div>
</header>

<main class="container">
  <div class="tool-content">
    <h1 class="tool-title">PDF to Image Converter</h1>
    <p class="tool-description">Convert PDF files to high-quality images in PNG, JPG, or WebP format. Your files are processed entirely in your browser—no server uploads.</p>
    
    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">
        <i class="fas fa-file-pdf"></i>
      </div>
      <div class="upload-text">Drop your PDF file here or click to browse</div>
      <div class="upload-subtext">Maximum file size: 200MB (browser dependent)</div>
      <input type="file" id="fileInput" class="file-input" accept=".pdf">
    </div>
    
    <div id="selectedFileContainer" style="display: none;">
      <div class="selected-file">
        <div class="file-icon">
          <i class="fas fa-file-pdf"></i>
        </div>
        <div class="file-info">
          <div class="file-name" id="fileName">document.pdf</div>
          <div class="file-size" id="fileSize">0 KB</div>
        </div>
        <button class="remove-file" id="removeFile" title="Remove selected file">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    
    <div class="conversion-options">
      <div class="option-column">
        <div class="option-group">
          <label for="formatSelect">Output Format</label>
          <select id="formatSelect">
            <option value="png">PNG (Lossless)</option>
            <option value="jpeg">JPG (Good Quality)</option>
            <option value="webp">WebP (Modern)</option>
          </select>
        </div>
        <div class="option-group">
          <label for="pageRange">Page Range</label>
          <div class="page-range">
            <input type="text" id="pageFrom" placeholder="1" value="1">
            <span style="color:var(--muted)">to</span>
            <input type="text" id="pageTo" placeholder="All" value="All">
          </div>
        </div>
      </div>
      <div class="option-column">
        <div class="option-group">
          <label for="qualitySlider">Quality (for JPG/WebP)</label>
          <div class="quality-slider">
            <label>
              Quality <span id="qualityValue">90%</span>
            </label>
            <input type="range" id="qualitySlider" min="10" max="100" value="90">
          </div>
        </div>
        <div class="option-group">
          <label for="dpiSelect">Resolution</label>
          <select id="dpiSelect">
            <option value="72">72 DPI (Screen)</option>
            <option value="150" selected>150 DPI (Standard)</option>
            <option value="300">300 DPI (High Quality)</option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="preview-area">
      <div class="preview-placeholder" id="previewPlaceholder">
        <i class="fas fa-image" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
        <p>Preview will appear here after conversion</p>
      </div>
      <img class="preview-image" id="previewImage" style="display: none;">
    </div>
    
    <div class="action-buttons">
      <button class="btn btn-primary" id="convertBtn" disabled>
        <i class="fas fa-sync-alt"></i> Convert to Images
      </button>
      <button class="btn btn-secondary" id="downloadAllBtn" disabled>
        <i class="fas fa-download"></i> Download All (ZIP)
      </button>
      <button class="btn btn-secondary" id="resetBtn">
        <i class="fas fa-redo"></i> Reset
      </button>
    </div>
    
    <div id="statusMessage" class="status-message"></div>
    
    <div class="results-container" id="resultsContainer">
      <h3>Converted Images</h3>
      <div class="results-grid" id="resultsGrid"></div>
    </div>
  </div>
</main>

<footer class="container">
  <div class="footer-inner">
    <div>© <span id="year"></span> Smarttool Hub</div>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="contact.html">Contact</a>
      <a href="comments.html">Comments</a>
      <a href="faq.html">FAQ</a>
    </div>
  </div>
</footer>

<!-- Libraries -->
<!-- PDF.js (mozilla) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.140/pdf.min.js"></script>
<!-- JSZip and FileSaver for ZIP download -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
  // Set current year
  document.getElementById('year').textContent = new Date().getFullYear();

  // Theme toggle functionality
  const themeToggle = document.getElementById('themeToggle');
  if (localStorage.getItem('sth_theme') === 'light') {
    document.body.classList.add('light');
    themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
  }
  themeToggle.onclick = () => {
    document.body.classList.toggle('light');
    if (document.body.classList.contains('light')) {
      themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
      localStorage.setItem('sth_theme', 'light');
    } else {
      themeToggle.innerHTML = '<i class="fa-solid fa-moon"></i>';
      localStorage.removeItem('sth_theme');
    }
  };

  // Elements
  const uploadArea = document.getElementById('uploadArea');
  const fileInput = document.getElementById('fileInput');
  const selectedFileContainer = document.getElementById('selectedFileContainer');
  const fileNameEl = document.getElementById('fileName');
  const fileSizeEl = document.getElementById('fileSize');
  const removeFileBtn = document.getElementById('removeFile');
  const formatSelect = document.getElementById('formatSelect');
  const pageFrom = document.getElementById('pageFrom');
  const pageTo = document.getElementById('pageTo');
  const qualitySlider = document.getElementById('qualitySlider');
  const qualityValue = document.getElementById('qualityValue');
  const dpiSelect = document.getElementById('dpiSelect');
  const previewPlaceholder = document.getElementById('previewPlaceholder');
  const previewImage = document.getElementById('previewImage');
  const convertBtn = document.getElementById('convertBtn');
  const downloadAllBtn = document.getElementById('downloadAllBtn');
  const resetBtn = document.getElementById('resetBtn');
  const statusMessage = document.getElementById('statusMessage');
  const resultsContainer = document.getElementById('resultsContainer');
  const resultsGrid = document.getElementById('resultsGrid');

  // PDF.js worker setup (uses the same CDN file)
  if (window.pdfjsLib) {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.140/pdf.worker.min.js';
  }

  let selectedFile = null;
  let convertedImages = []; // {page, filename, blobUrl, blob}

  // Initialize
  updateQualityValue();

  // Drag & drop and file select
  uploadArea.addEventListener('click', () => fileInput.click());
  uploadArea.addEventListener('dragover', handleDragOver);
  uploadArea.addEventListener('dragleave', handleDragLeave);
  uploadArea.addEventListener('drop', handleDrop);
  fileInput.addEventListener('change', handleFileSelect);
  removeFileBtn.addEventListener('click', removeSelectedFile);
  qualitySlider.addEventListener('input', updateQualityValue);
  convertBtn.addEventListener('click', convertToImages);
  downloadAllBtn.addEventListener('click', downloadAllImages);
  resetBtn.addEventListener('click', resetTool);

  function handleDragOver(e) { e.preventDefault(); e.stopPropagation(); uploadArea.classList.add('dragover'); }
  function handleDragLeave(e) { e.preventDefault(); e.stopPropagation(); uploadArea.classList.remove('dragover'); }
  function handleDrop(e) {
    e.preventDefault(); e.stopPropagation(); uploadArea.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      const file = files[0];
      if (file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')) handleFile(file);
      else showStatus('Please drop a PDF file', 'error');
    }
  }

  function handleFileSelect(e) {
    const file = e.target.files[0];
    if (!file) return;
    if (file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')) {
      handleFile(file);
    } else {
      showStatus('Please select a PDF file', 'error');
    }
  }

  function handleFile(file) {
    selectedFile = file;
    fileNameEl.textContent = file.name;
    fileSizeEl.textContent = formatFileSize(file.size);
    selectedFileContainer.style.display = 'block';
    convertBtn.disabled = false;
    showStatus('PDF file selected', 'success');
  }

  function removeSelectedFile() {
    selectedFile = null;
    fileInput.value = '';
    selectedFileContainer.style.display = 'none';
    convertBtn.disabled = true;
    downloadAllBtn.disabled = true;
    hideResults();
  }

  function updateQualityValue() {
    qualityValue.textContent = `${qualitySlider.value}%`;
  }

  // --- Conversion flow ---
  async function convertToImages() {
    if (!selectedFile) { showStatus('Please select a PDF file first', 'error'); return; }

    showStatus('Loading PDF into memory...', 'info');
    convertBtn.disabled = true;
    downloadAllBtn.disabled = true;
    resultsGrid.innerHTML = '';
    convertedImages = [];
    resultsContainer.style.display = 'none';

    try {
      // Read file as ArrayBuffer
      const arrayBuffer = await readFileAsArrayBuffer(selectedFile);

      showStatus('Parsing PDF (this may take a moment)...', 'info');

      const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
      const pdf = await loadingTask.promise;

      const totalPages = pdf.numPages;
      // parse page range
      const { start, end } = parsePageRange(pageFrom.value.trim(), pageTo.value.trim(), totalPages);

      showStatus(`Rendering pages ${start} to ${end} of ${totalPages}...`, 'info');

      const dpi = parseInt(dpiSelect.value || '150', 10);
      const scale = dpi / 72; // PDF default 72dpi
      const format = formatSelect.value; // 'png'|'jpeg'|'webp'
      const quality = Math.max(0.1, Math.min(1, parseInt(qualitySlider.value, 10) / 100));

      // For each page, render to canvas and export
      for (let p = start; p <= end; p++) {
        showStatus(`Rendering page ${p} / ${end}...`, 'info');
        const page = await pdf.getPage(p);
        const viewport = page.getViewport({ scale });
        // create canvas sized to viewport
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d', { alpha: true });
        // set canvas pixel size
        canvas.width = Math.floor(viewport.width);
        canvas.height = Math.floor(viewport.height);

        // Use a default white background for JPEG (since JPEG has no alpha)
        if (format === 'jpeg') {
          context.fillStyle = '#ffffff';
          context.fillRect(0, 0, canvas.width, canvas.height);
        }

        const renderContext = {
          canvasContext: context,
          viewport: viewport
        };
        await page.render(renderContext).promise;

        // Convert canvas to blob (respect quality)
        const mime = format === 'png' ? 'image/png' : (format === 'jpeg' ? 'image/jpeg' : 'image/webp');

        const blob = await new Promise((resolve) => {
          // toBlob supports quality for jpeg/webp; ignored for png
          canvas.toBlob(resolve, mime, quality);
        });

        const filenameBase = selectedFile.name.replace(/\.pdf$/i, '');
        const filename = `${filenameBase}_page_${p}.${format === 'jpeg' ? 'jpg' : format}`;

        const blobUrl = URL.createObjectURL(blob);

        convertedImages.push({ page: p, filename, blob, blobUrl, mime });
        // add to results grid
        addResultItem(p, blobUrl, filename, mime);
        await waitFrame(); // let browser breathe between pages
      }

      resultsContainer.style.display = 'block';
      downloadAllBtn.disabled = false;
      previewFirstImage();
      showStatus(`Successfully converted pages ${start}-${end} to ${format.toUpperCase()} images`, 'success');
    } catch (err) {
      console.error(err);
      showStatus('Conversion failed: ' + (err && err.message ? err.message : err), 'error');
    } finally {
      convertBtn.disabled = false;
    }
  }

  function addResultItem(page, blobUrl, filename, mime) {
    const item = document.createElement('div');
    item.className = 'result-item';
    item.innerHTML = `
      <img src="${blobUrl}" alt="Page ${page}" class="result-image" loading="lazy">
      <div class="result-info">Page ${page}</div>
      <div class="result-actions">
        <button class="result-btn view-btn" data-page="${page}"><i class="fas fa-eye"></i> View</button>
        <button class="result-btn download-btn" data-page="${page}"><i class="fas fa-download"></i> Download</button>
      </div>
    `;
    resultsGrid.appendChild(item);

    item.querySelector('.view-btn').addEventListener('click', () => {
      previewPlaceholder.style.display = 'none';
      previewImage.style.display = 'block';
      previewImage.src = blobUrl;
      previewImage.alt = filename;
      showStatus(`Previewing ${filename}`, 'info');
    });

    item.querySelector('.download-btn').addEventListener('click', () => {
      downloadBlobAsFile(blobUrl, filename);
      showStatus(`Downloaded ${filename}`, 'success');
    });
  }

  function previewFirstImage() {
    if (convertedImages.length > 0) {
      previewPlaceholder.style.display = 'none';
      const first = convertedImages[0];
      previewImage.src = first.blobUrl;
      previewImage.style.display = 'block';
      previewImage.alt = first.filename;
    }
  }

  async function downloadAllImages() {
    if (convertedImages.length === 0) return;
    showStatus('Preparing ZIP file...', 'info');
    downloadAllBtn.disabled = true;

    try {
      // Use JSZip to zip blobs
      const zip = new JSZip();
      const folder = zip.folder(selectedFile.name.replace(/\.pdf$/i, '') || 'images');

      // add each blob to zip. use blob directly
      for (let i = 0; i < convertedImages.length; i++) {
        const img = convertedImages[i];
        folder.file(img.filename, img.blob);
      }
      const zipBlob = await zip.generateAsync({ type: 'blob' }, (metadata) => {
        // show progress occasionally
        showStatus(`Zipping... ${Math.round(metadata.percent)}%`, 'info');
      });
      saveAs(zipBlob, `${selectedFile.name.replace(/\.pdf$/i, '') || 'images'}.zip`);
      showStatus('ZIP download started', 'success');
    } catch (err) {
      console.error(err);
      showStatus('Failed to create ZIP: ' + err, 'error');
    } finally {
      downloadAllBtn.disabled = false;
    }
  }

  // Utility: download a blob URL as file
  function downloadBlobAsFile(blobUrl, filename) {
    const a = document.createElement('a');
    a.href = blobUrl;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  // Helpers
  function readFileAsArrayBuffer(file) {
    return new Promise((resolve, reject) => {
      const fr = new FileReader();
      fr.onload = () => resolve(fr.result);
      fr.onerror = reject;
      fr.readAsArrayBuffer(file);
    });
  }

  function parsePageRange(fromStr, toStr, totalPages) {
    let start = 1, end = totalPages;
    const parsedFrom = parseInt(fromStr, 10);
    if (!isNaN(parsedFrom) && parsedFrom >= 1) start = Math.min(parsedFrom, totalPages);
    if (toStr.trim().toLowerCase() === 'all' || toStr.trim() === '') {
      end = totalPages;
    } else {
      const parsedTo = parseInt(toStr, 10);
      if (!isNaN(parsedTo) && parsedTo >= start) end = Math.min(parsedTo, totalPages);
    }
    if (start > end) start = end; // repair
    return { start, end };
  }

  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  function showStatus(message, type) {
    statusMessage.textContent = message;
    statusMessage.classList.remove('status-success', 'status-error');
    if (type === 'success') statusMessage.classList.add('status-success');
    else if (type === 'error') statusMessage.classList.add('status-error');
    statusMessage.style.display = 'block';
    if (type !== 'info') {
      setTimeout(() => {
        statusMessage.style.display = 'none';
      }, 5000);
    }
  }

  function hideResults() {
    resultsContainer.style.display = 'none';
    previewPlaceholder.style.display = 'block';
    previewImage.style.display = 'none';
    previewImage.src = '';
    convertedImages.forEach(i => {
      try { URL.revokeObjectURL(i.blobUrl); } catch(e){}
    });
    convertedImages = [];
    resultsGrid.innerHTML = '';
  }

  function resetTool() {
    removeSelectedFile();
    formatSelect.value = 'png';
    pageFrom.value = '1';
    pageTo.value = 'All';
    qualitySlider.value = '90';
    dpiSelect.value = '150';
    updateQualityValue();
    hideResults();
    showStatus('Tool reset', 'success');
  }

  // small helper to let UI breathe between synchronous heavy ops
  function waitFrame() {
    return new Promise((res) => requestAnimationFrame(() => setTimeout(res, 20)));
  }

  // Download helper for the preview/individual items
  function downloadImage(pageNum) {
    const img = convertedImages.find(i => i.page === Number(pageNum));
    if (img) downloadBlobAsFile(img.blobUrl, img.filename);
  }
</script>
</body>
</html>
