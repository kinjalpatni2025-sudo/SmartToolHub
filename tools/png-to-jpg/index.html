<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>PNG to JPG Converter - Smarttool Hub</title>
  <meta name="description" content="Convert between PNG and JPG image formats. 100% browser-based, private and fast."/>
  <link rel="icon" href="https://img.icons8.com/fluency/48/toolbox.png"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <style>
    :root{
      --bg:#0b1220;--text:#eaf2ff;--card:#182335;--border:#2a3b55;
      --primary:#22d3ee;--muted:#9fb3c8;--radius:12px;
    }
    body.light{
      --bg:#f6f8fb;--text:#0b1220;--card:#ffffff;--border:#e6eefc;
      --primary:#0b74ff;--muted:#556677;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg);color:var(--text);transition:background .25s,color .25s;
      min-height:100vh;display:flex;flex-direction:column;
    }
    .container{max-width:1200px;margin:0 auto;padding:20px;width:100%}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      background:var(--card);border-bottom:1px solid var(--border);padding:14px 20px;
    }
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:46px;height:46px;border-radius:10px}
    .brand .title{font-size:1.25rem;font-weight:700;color:var(--primary);margin:0}
    .brand .tag{font-size:.9rem;color:var(--muted)}
    .header-actions{display:flex;gap:10px;align-items:center}
    .btn-header{
      border:1px solid var(--border);background:transparent;padding:8px 12px;border-radius:8px;
      color:var(--text);cursor:pointer;display:flex;align-items:center;gap:6px;text-decoration:none;font-weight:600
    }
    .btn-header:hover{border-color:var(--primary);color:var(--primary)}
    
    /* Tool-specific styles (kept same) */
    .tool-content {
      background:var(--card);border-radius:var(--radius);border:1px solid var(--border);
      padding:25px;margin-top:20px;
    }
    .tool-title {
      font-size:1.8rem;margin-bottom:5px;color:var(--primary);
    }
    .tool-description {
      color:var(--muted);margin-bottom:25px;
    }

    /* Upload area */
    .upload-area {
      border:2px dashed var(--border);border-radius:var(--radius);padding:30px;
      text-align:center;margin-bottom:20px;transition:all 0.3s;cursor:pointer;
      background:var(--bg);
    }
    .upload-area:hover, .upload-area.dragover {
      border-color:var(--primary);background:rgba(34,211,238,0.05);
    }
    .upload-icon {
      font-size:3rem;color:var(--muted);margin-bottom:12px;
    }
    .upload-text {
      color:var(--text);margin-bottom:10px;font-weight:600;
    }
    .upload-subtext {
      color:var(--muted);font-size:0.9rem;
    }
    .file-input {
      display:none;
    }

    /* Selected files list (bulk) - style matches original look */
    .selected-list {
      display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-bottom:18px;
    }
    .file-card {
      background:var(--bg);border:1px solid var(--border);padding:12px;border-radius:10px;display:flex;gap:12px;align-items:flex-start;
    }
    .thumb {width:96px;height:72px;border-radius:8px;object-fit:cover;background:#0f1720;border:1px solid var(--border)}
    .file-meta {flex:1}
    .file-meta h5{margin:0 0 6px 0;font-size:0.95rem;color:var(--text)}
    .file-meta p{margin:0;color:var(--muted);font-size:0.88rem}
    .file-actions {display:flex;flex-direction:column;gap:8px}
    .format-badge {font-size:0.75rem;padding:6px 8px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--muted);display:inline-block}
    .small-btn {padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
    .small-btn.primary {background:var(--primary);color:#00131f}
    .small-btn.secondary {background:var(--card);border:1px solid var(--border);color:var(--text)}

    /* Conversion options (kept original) */
    .conversion-options {
      margin-bottom:25px;
    }
    .conversion-options h3 {
      margin-bottom:15px;color:var(--primary);font-size:1.1rem;
    }
    .format-selector {
      display:flex;gap:15px;flex-wrap:wrap;margin-bottom:20px;
    }
    .format-option {
      flex:1;min-width:150px;background:var(--bg);border:1px solid var(--border);
      border-radius:var(--radius);padding:15px;cursor:pointer;transition:all 0.2s;
      text-align:center;
    }
    .format-option:hover, .format-option.active {
      border-color:var(--primary);background:rgba(34,211,238,0.05);
    }
    .format-option.active { border-width:2px; }
    .quality-slider { display:flex;flex-direction:column;gap:8px;margin-bottom:20px; }
    .quality-slider label { display:flex;justify-content:space-between;font-weight:500;color:var(--text); }
    .quality-slider span { color:var(--muted);font-size:0.9rem; }
    input[type="range"] { width:100%;height:6px;border-radius:3px;background:var(--bg);outline:none;-webkit-appearance:none; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--primary);cursor:pointer; }

    /* Preview grid (kept original) */
    .preview-container {
      display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:25px;
    }
    .preview-box {
      border:1px solid var(--border);border-radius:var(--radius);padding:15px;background:var(--bg);text-align:center;
    }
    .preview-box h4 { margin:0 0 10px 0;color:var(--text);font-size:1rem; }
    .preview-image { max-width:100%;max-height:200px;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    .preview-info { margin-top:10px;color:var(--muted);font-size:0.9rem; }

    .action-buttons { display:flex;gap:12px;flex-wrap:wrap; }
    .btn { padding:12px 20px;border-radius:var(--radius);border:none;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px; }
    .btn-primary { background:var(--primary);color:#00131f; }
    .btn-secondary { background:var(--card);color:var(--text);border:1px solid var(--border); }
    .btn:disabled { opacity:0.6;cursor:not-allowed; }
    .status-message {
      margin-top:15px;padding:10px;border-radius:var(--radius);
      background:var(--bg);border:1px solid var(--border);
      color:var(--muted);font-size:0.9rem;display:none;
    }
    .status-success { border-color:#10b981;color:#10b981; }
    .status-error { border-color:#ef4444;color:#ef4444; }

    footer{margin-top:auto;padding:18px 0;background:var(--card);border-top:1px solid var(--border)}
    .footer-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .footer-links{display:flex;gap:14px;flex-wrap:wrap}
    .footer-links a{color:var(--primary);text-decoration:none;font-weight:600}
    @media (max-width:720px){
      header{flex-direction:column;align-items:flex-start;gap:10px}
      .header-actions{align-self:flex-end}
      .preview-container{grid-template-columns:1fr;}
      .format-selector{flex-direction:column;}
      .action-buttons{flex-direction:column;}
      .btn{width:100%;justify-content:center;}
    }
  </style>
</head>
<body>
<header class="container">
  <div class="brand">
    <a href="index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;">
      <img src="https://img.icons8.com/fluency/48/toolbox.png" alt="Smarttool Hub Logo">
      <div>
        <div class="title">Smarttool Hub</div>
        <div class="tag">Fast • Private • 100% Client-side</div>
      </div>
    </a>
  </div>
  <div class="header-actions">
    <a href="index.html" class="btn-header"><i class="fa-solid fa-house"></i> Home</a>
    <button class="btn-header" id="themeToggle" title="Toggle dark/light mode"><i class="fa-solid fa-moon"></i></button>
  </div>
</header>

<main class="container">
  <div class="tool-content">
    <h1 class="tool-title">PNG to JPG Converter</h1>
    <p class="tool-description">Convert between PNG and JPG image formats. Your images are processed entirely in your browser—no server uploads.</p>

    <!-- Upload area (click or drop multiple) -->
    <div class="upload-area" id="uploadArea" title="Click or drop images here (PNG/JPG) to add multiple files">
      <div class="upload-icon"><i class="fas fa-image"></i></div>
      <div class="upload-text">Drop images here or click to browse</div>
      <div class="upload-subtext">Supports PNG and JPG formats — select multiple files</div>
      <input type="file" id="fileInput" class="file-input" accept=".png,.jpg,.jpeg" multiple>
    </div>

    <!-- Bulk selected files preview (keeps original styling) -->
    <div id="selectedList" class="selected-list" aria-live="polite"></div>

    <!-- Conversion options + preview area (kept original layout) -->
    <div id="conversionOptions" style="display:block;">
      <div class="conversion-options">
        <h3>Conversion Options</h3>
        <div class="format-selector" id="globalFormatSelector">
          <div class="format-option active" data-format="png-to-jpg">
            <h4>PNG to JPG</h4>
            <p>Convert PNG to JPG format</p>
          </div>
          <div class="format-option" data-format="jpg-to-png">
            <h4>JPG to PNG</h4>
            <p>Convert JPG to PNG format</p>
          </div>
        </div>

        <div class="quality-slider" id="qualitySliderContainer">
          <label>
            JPG Quality <span id="qualityValue">85%</span>
          </label>
          <input type="range" id="qualitySlider" min="50" max="100" value="85">
        </div>
      </div>

      <div class="preview-container" id="previewContainer">
        <div class="preview-box">
          <h4>Original Image (first selected)</h4>
          <img class="preview-image" id="originalPreview" src="https://via.placeholder.com/300x200/182335/22d3ee/?text=Original+Image">
          <div class="preview-info" id="originalInfo">Format: PNG • Size: 0 KB</div>
        </div>
        <div class="preview-box">
          <h4>Converted Image (preview)</h4>
          <img class="preview-image" id="convertedPreview" src="https://via.placeholder.com/300x200/182335/22d3ee/?text=Converted+Image">
          <div class="preview-info" id="convertedInfo">Format: JPG • Size: 0 KB</div>
        </div>
      </div>

      <div class="action-buttons" style="align-items:center;">
        <button class="btn btn-primary" id="convertAllBtn" disabled><i class="fas fa-sync-alt"></i> Convert All</button>
        <button class="btn btn-secondary" id="downloadAllBtn" disabled><i class="fas fa-download"></i> Download All (ZIP)</button>
        <button class="btn btn-secondary" id="resetBtn"><i class="fas fa-redo"></i> Reset</button>
        <div style="margin-left:auto;color:var(--muted);font-weight:600" id="summaryText">No files selected</div>
      </div>
    </div>

    <div id="statusMessage" class="status-message"></div>
  </div>
</main>

<footer class="container">
  <div class="footer-inner">
    <div>© <span id="year"></span> Smarttool Hub</div>
    <div class="footer-links">
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="contact.html">Contact</a>
      <a href="comments.html">Comments</a>
      <a href="faq.html">FAQ</a>
    </div>
  </div>
</footer>

<!-- JSZip for ZIP download -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
  // preserve original behavior: set year & theme toggle
  document.getElementById('year').textContent = new Date().getFullYear();
  const themeToggle = document.getElementById('themeToggle');
  if (localStorage.getItem('sth_theme') === 'light') {
    document.body.classList.add('light');
    themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
  }
  themeToggle.onclick = () => {
    document.body.classList.toggle('light');
    if (document.body.classList.contains('light')) {
      themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
      localStorage.setItem('sth_theme', 'light');
    } else {
      themeToggle.innerHTML = '<i class="fa-solid fa-moon"></i>';
      localStorage.removeItem('sth_theme');
    }
  };

  // Elements
  const uploadArea = document.getElementById('uploadArea');
  const fileInput = document.getElementById('fileInput');
  const selectedList = document.getElementById('selectedList');
  const globalFormatSelector = document.getElementById('globalFormatSelector');
  const formatOptions = document.querySelectorAll('.format-option');
  const qualitySlider = document.getElementById('qualitySlider');
  const qualityValue = document.getElementById('qualityValue');
  const convertAllBtn = document.getElementById('convertAllBtn');
  const downloadAllBtn = document.getElementById('downloadAllBtn');
  const resetBtn = document.getElementById('resetBtn');
  const summaryText = document.getElementById('summaryText');
  const statusMessage = document.getElementById('statusMessage');
  const originalPreview = document.getElementById('originalPreview');
  const convertedPreview = document.getElementById('convertedPreview');
  const originalInfo = document.getElementById('originalInfo');
  const convertedInfo = document.getElementById('convertedInfo');

  // State
  let filesState = []; // {id,file,originalDataUrl,convertedDataUrl,outputBlob,convertedName,outputFormat}
  let globalFormat = 'png-to-jpg';
  let currentQuality = Number(qualitySlider.value);

  // Helpers
  function uid(){ return 'f_' + Math.random().toString(36).slice(2,9); }
  function isImageFile(f){ return f && (f.type === 'image/png' || f.type === 'image/jpeg'); }
  function showStatus(message, type='success', autoHide=true){
    statusMessage.textContent = message;
    statusMessage.classList.remove('status-success','status-error');
    statusMessage.style.display = 'block';
    if (type==='success') statusMessage.classList.add('status-success');
    if (type==='error') statusMessage.classList.add('status-error');
    if (autoHide) setTimeout(()=> statusMessage.style.display='none', 5000);
  }
  function formatFileSize(bytes){
    if (!bytes) return '0 Bytes';
    const k=1024; const sizes=['Bytes','KB','MB','GB']; const i=Math.floor(Math.log(bytes)/Math.log(k));
    return parseFloat((bytes / Math.pow(k,i)).toFixed(2)) + ' ' + sizes[i];
  }
  function dataURLtoBlob(dataURL){
    const parts = dataURL.split(',');
    const mime = parts[0].match(/:(.*?);/)[1];
    const raw = atob(parts[1]);
    const u8 = new Uint8Array(raw.length);
    for (let i=0;i<raw.length;i++) u8[i] = raw.charCodeAt(i);
    return new Blob([u8], {type: mime});
  }

  // Upload handlers
  uploadArea.addEventListener('click', () => fileInput.click());
  uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
  uploadArea.addEventListener('dragleave', e => { e.preventDefault(); uploadArea.classList.remove('dragover'); });
  uploadArea.addEventListener('drop', e => {
    e.preventDefault(); uploadArea.classList.remove('dragover');
    const incoming = Array.from(e.dataTransfer.files || []);
    handleFilesAdded(incoming);
  });
  fileInput.addEventListener('change', e => {
    handleFilesAdded(Array.from(e.target.files || []));
    fileInput.value = '';
  });

  function handleFilesAdded(list){
    const incoming = list.filter(isImageFile);
    const rejected = list.filter(f => !isImageFile(f));
    if (rejected.length) showStatus(`${rejected.length} file(s) skipped (not PNG/JPG)`, 'error');
    if (!incoming.length) {
      if (filesState.length===0) showStatus('No valid images added', 'error');
      return;
    }
    incoming.forEach(file => {
      const id = uid();
      const entry = { id, file, originalDataUrl: null, convertedDataUrl: null, outputBlob: null, convertedName: null, outputFormat: null };
      filesState.push(entry);
      const reader = new FileReader();
      reader.onload = ev => { entry.originalDataUrl = ev.target.result; renderFileCards(); };
      reader.readAsDataURL(file);
    });
    renderFileCards();
    updateControls();
    showStatus(`${incoming.length} file(s) added`, 'success');
  }

  // Render selected files list (keeps original design)
  function renderFileCards(){
    selectedList.innerHTML = '';
    filesState.forEach(entry => {
      const file = entry.file;
      const card = document.createElement('div'); card.className='file-card'; card.id = 'card-'+entry.id;

      const img = document.createElement('img'); img.className='thumb'; img.src = entry.originalDataUrl || 'https://via.placeholder.com/300x200/182335/22d3ee/?text=Image';
      img.alt = file.name;
      card.appendChild(img);

      const meta = document.createElement('div'); meta.className='file-meta';
      const h5 = document.createElement('h5'); h5.textContent = file.name; meta.appendChild(h5);
      const p1 = document.createElement('p'); p1.textContent = `Format: ${file.type.split('/')[1].toUpperCase()} • Size: ${formatFileSize(file.size)}`; meta.appendChild(p1);
      const p2 = document.createElement('p'); p2.style.marginTop='6px';
      p2.innerHTML = entry.outputBlob ? `<span class="format-badge">Converted: ${entry.outputFormat.split('/')[1].toUpperCase()}</span> • ${formatFileSize(entry.outputBlob.size)}` : `<span class="format-badge">Not converted</span>`;
      meta.appendChild(p2);
      card.appendChild(meta);

      const actions = document.createElement('div'); actions.className='file-actions';
      const convertBtn = document.createElement('button'); convertBtn.className='small-btn primary'; convertBtn.textContent='Convert';
      convertBtn.onclick = ()=> convertSingle(entry.id);
      const downloadBtn = document.createElement('button'); downloadBtn.className='small-btn secondary'; downloadBtn.innerHTML = '<i class="fas fa-download"></i> Download';
      downloadBtn.disabled = !entry.outputBlob;
      downloadBtn.onclick = ()=> {
        if (!entry.outputBlob) return;
        const url = URL.createObjectURL(entry.outputBlob);
        const a = document.createElement('a'); a.href = url; a.download = entry.convertedName || file.name;
        document.body.appendChild(a); a.click();
        setTimeout(()=>{ URL.revokeObjectURL(url); document.body.removeChild(a); }, 300);
      };
      const removeBtn = document.createElement('button'); removeBtn.className='small-btn secondary'; removeBtn.innerHTML = '<i class="fas fa-trash"></i>';
      removeBtn.onclick = ()=> { filesState = filesState.filter(f => f.id !== entry.id); renderFileCards(); updateControls(); showStatus('File removed', 'success'); };

      actions.appendChild(convertBtn); actions.appendChild(downloadBtn); actions.appendChild(removeBtn);
      card.appendChild(actions);
      selectedList.appendChild(card);
    });

    summaryText.textContent = filesState.length ? `${filesState.length} file(s) selected` : 'No files selected';

    // Update preview (show first file as preview)
    if (filesState.length) {
      const e = filesState[0];
      if (e.originalDataUrl) {
        originalPreview.src = e.originalDataUrl;
        originalInfo.textContent = `Format: ${e.file.type.split('/')[1].toUpperCase()} • Size: ${formatFileSize(e.file.size)}`;
      }
      if (e.convertedDataUrl) {
        convertedPreview.src = e.convertedDataUrl;
        convertedInfo.textContent = `Format: ${e.outputFormat.split('/')[1].toUpperCase()} • Size: ${formatFileSize(e.outputBlob.size)}`;
      } else {
        convertedPreview.src = 'https://via.placeholder.com/300x200/182335/22d3ee/?text=Converted+Image';
        convertedInfo.textContent = `Format: ${globalFormat === 'png-to-jpg' ? 'JPG' : 'PNG'} • Size: 0 KB`;
      }
    } else {
      originalPreview.src = 'https://via.placeholder.com/300x200/182335/22d3ee/?text=Original+Image';
      originalInfo.textContent = 'Format: PNG • Size: 0 KB';
      convertedPreview.src = 'https://via.placeholder.com/300x200/182335/22d3ee/?text=Converted+Image';
      convertedInfo.textContent = 'Format: JPG • Size: 0 KB';
    }
    updateControls();
  }

  function updateControls(){
    convertAllBtn.disabled = filesState.length === 0;
    downloadAllBtn.disabled = filesState.filter(f => f.outputBlob).length === 0;
  }

  // Conversion logic (single & bulk)
  function convertSingle(id){
    const entry = filesState.find(f => f.id === id);
    if (!entry) return;
    const file = entry.file;
    const reader = new FileReader();
    reader.onload = function(ev){
      const img = new Image();
      img.onload = function(){
        const canvas = document.createElement('canvas');
        canvas.width = img.width; canvas.height = img.height;
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img, 0, 0);

        let outFormat, quality;
        if (globalFormat === 'png-to-jpg') {
          outFormat = 'image/jpeg';
          quality = currentQuality / 100;
          if (file.type === 'image/png') {
            ctx.globalCompositeOperation = 'destination-over';
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.globalCompositeOperation = 'source-over';
          }
        } else {
          outFormat = 'image/png';
          quality = 1;
        }

        const dataUrl = canvas.toDataURL(outFormat, quality);
        entry.convertedDataUrl = dataUrl;
        entry.outputBlob = dataURLtoBlob(dataUrl);
        const base = file.name.replace(/\.[^/.]+$/, '');
        const ext = outFormat === 'image/jpeg' ? 'jpg' : 'png';
        entry.convertedName = `${base}.${ext}`;
        entry.outputFormat = outFormat;

        renderFileCards();
        showStatus(`${file.name} converted`, 'success');
      };
      img.onerror = function(){ showStatus('Error loading image for conversion', 'error'); };
      img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
  }

  async function convertAll(){
    if (filesState.length === 0) { showStatus('No files to convert', 'error'); return; }
    showStatus('Converting all images...', 'success', false);
    for (let entry of filesState) {
      await new Promise(resolve => {
        const file = entry.file;
        const reader = new FileReader();
        reader.onload = ev => {
          const img = new Image();
          img.onload = function(){
            const canvas = document.createElement('canvas');
            canvas.width = img.width; canvas.height = img.height;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.drawImage(img, 0, 0);

            let outFormat, quality;
            if (globalFormat === 'png-to-jpg') {
              outFormat = 'image/jpeg';
              quality = currentQuality / 100;
              if (file.type === 'image/png') {
                ctx.globalCompositeOperation = 'destination-over';
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0,0,canvas.width,canvas.height);
                ctx.globalCompositeOperation = 'source-over';
              }
            } else {
              outFormat = 'image/png';
              quality = 1;
            }

            const dataUrl = canvas.toDataURL(outFormat, quality);
            entry.convertedDataUrl = dataUrl;
            entry.outputBlob = dataURLtoBlob(dataUrl);
            const base = file.name.replace(/\.[^/.]+$/, '');
            const ext = outFormat === 'image/jpeg' ? 'jpg' : 'png';
            entry.convertedName = `${base}.${ext}`;
            entry.outputFormat = outFormat;
            renderFileCards();
            resolve();
          };
          img.onerror = function(){ console.warn('image load error for', file.name); resolve(); };
          img.src = ev.target.result;
        };
        reader.readAsDataURL(entry.file);
      });
    }
    showStatus('All images converted', 'success');
    updateControls();
  }

  // ZIP download
  async function downloadAllAsZip(){
    const convertedEntries = filesState.filter(f => f.outputBlob);
    if (convertedEntries.length === 0) { showStatus('No converted files to download', 'error'); return; }
    if (typeof JSZip === 'undefined') { showStatus('JSZip not loaded. Check CDN.', 'error'); return; }

    showStatus('Preparing ZIP...', 'success', false);
    try {
      const zip = new JSZip();
      convertedEntries.forEach(e => {
        zip.file(e.convertedName, e.outputBlob);
      });

      const blob = await zip.generateAsync({ type: 'blob', compression: 'DEFLATE', compressionOptions: { level: 6 } });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url;
      const ts = new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
      a.download = `converted_images_${ts}.zip`;
      document.body.appendChild(a); a.click();
      setTimeout(()=> { URL.revokeObjectURL(url); document.body.removeChild(a); }, 500);
      showStatus('ZIP downloaded', 'success');
    } catch (err) {
      console.error(err);
      showStatus('Failed to create ZIP', 'error');
    }
  }

  // Global format selector behavior & quality slider
  formatOptions.forEach(opt => {
    opt.addEventListener('click', () => {
      formatOptions.forEach(o => o.classList.remove('active'));
      opt.classList.add('active');
      globalFormat = opt.getAttribute('data-format');
      document.getElementById('qualitySliderContainer').style.display = globalFormat === 'png-to-jpg' ? 'flex' : 'none';
    });
  });
  qualitySlider.addEventListener('input', () => {
    currentQuality = Number(qualitySlider.value);
    qualityValue.textContent = `${currentQuality}%`;
  });

  // Buttons
  convertAllBtn.addEventListener('click', async () => { await convertAll(); });
  downloadAllBtn.addEventListener('click', downloadAllAsZip);
  resetBtn.addEventListener('click', () => {
    filesState = []; selectedList.innerHTML=''; renderFileCards(); qualitySlider.value = 85; currentQuality = 85; qualityValue.textContent='85%';
    document.querySelector('.format-option[data-format="png-to-jpg"]').classList.add('active');
    document.querySelector('.format-option[data-format="jpg-to-png"]').classList.remove('active');
    globalFormat='png-to-jpg'; document.getElementById('qualitySliderContainer').style.display='flex';
    showStatus('Tool reset', 'success');
  });

  // initial
  qualityValue.textContent = `${qualitySlider.value}%`;
  updateControls();

  // keyboard accessible: open file dialog with enter/space
  uploadArea.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); } });
</script>
</body>
</html>
